import { Component, EventEmitter, Input, Output, } from '@angular/core';
import * as _ from 'lodash';
import { TIMETABLE_CHANGE_DIRECTIONS, weekDayLabels, } from './constants';
import * as i0 from "@angular/core";
import * as i1 from "./calendar.helper";
import * as i2 from "@ngx-translate/core";
import * as i3 from "@angular/common";
import * as i4 from "./components/timetable-cell/timetable-cell.component";
import * as i5 from "./components/calendar-navi/calendar-navi.component";
export class CalendarComponent {
    constructor(tadaNgxCalendarHelper, translate) {
        this.tadaNgxCalendarHelper = tadaNgxCalendarHelper;
        this.translate = translate;
        this.lessionNumOfDay = [...Array(5).keys()];
        this.startRowTitles = this.buildRowTitles();
        this.month = this.tadaNgxCalendarHelper.getCurrentMonth();
        this.year = this.tadaNgxCalendarHelper.getActiveYear();
        this.updated = new EventEmitter();
        this.data = null;
        this.hideHeader = null;
        this.timeShift = null;
        this.daynamesOfWeek = [...weekDayLabels];
        this.timeTableData = {};
        this.objectKeys = Object.keys;
        this.weekdays = [];
        this.schedules = {};
        this.timeTableUIData = {};
        this.activeWeek = 0;
        this.totalWeekOfYear = 0;
        this.startDayOfWeek = null;
        this.translate.setDefaultLang('vn');
        this.buildRowTitles();
    }
    ngDoCheck() { }
    ngOnChanges(changes) {
        if (changes['data']?.currentValue && changes['data']?.currentValue.length) {
            this.onChangeSchedules();
        }
        if (changes['month']?.firstChange &&
            changes['month'].currentValue &&
            changes['year']?.firstChange &&
            changes['year'].currentValue) {
            this.activeWeek = this.tadaNgxCalendarHelper.currentWeekNumber();
            this.totalWeekOfYear = this.tadaNgxCalendarHelper.isoWeeksInYear(this.year);
            this.onChangeDirection(TIMETABLE_CHANGE_DIRECTIONS.MOVE_TODAY);
        }
        else if (changes['month']?.currentValue || changes['year']?.currentValue) {
            this.changeMonthYear();
        }
    }
    buildRowTitles() {
        return this.lessionNumOfDay.map((_, index) => `Tiết ${index + 1}`);
    }
    onChangeDirection(action) {
        switch (action) {
            case TIMETABLE_CHANGE_DIRECTIONS.MOVE_PREV:
                this.goPrevious();
                break;
            case TIMETABLE_CHANGE_DIRECTIONS.MOVE_NEXT:
                this.goNext();
                break;
            case TIMETABLE_CHANGE_DIRECTIONS.MOVE_TODAY:
                this.today();
                break;
            default:
                return;
        }
        this.handleDatetime(this.startDayOfWeek);
    }
    canGoPrevious() {
        return this.activeWeek < this.totalWeekOfYear;
    }
    canGoNext() {
        return this.activeWeek < this.totalWeekOfYear;
    }
    goPrevious() {
        this.startDayOfWeek = this.tadaNgxCalendarHelper.subtract(this.startDayOfWeek);
    }
    goNext() {
        this.startDayOfWeek = this.tadaNgxCalendarHelper.add(this.startDayOfWeek);
    }
    today() {
        const currentWeek = this.tadaNgxCalendarHelper.currentWeekNumber();
        this.startDayOfWeek = this.tadaNgxCalendarHelper.dayStartOfWeek(currentWeek, this.tadaNgxCalendarHelper.getCurrentYear());
    }
    handleDatetime(fromDate) {
        this.weekdays = this.tadaNgxCalendarHelper.getWeekDaysByDay(fromDate);
        this.activeWeek = this.tadaNgxCalendarHelper.getWeekNumberByDate(this.weekdays[0]);
        const [year, month] = fromDate.split('-');
        this.month = +month;
        this.year = +year;
        this.startDayOfWeek = this.tadaNgxCalendarHelper.dayStartOfWeek(this.activeWeek, this.year);
        this.timeTableUIData = {
            startDate: this.tadaNgxCalendarHelper.getTimeRange(this.weekdays[0])
                .timeStampUtc.startOfDay,
            endDate: this.tadaNgxCalendarHelper.getTimeRange(this.weekdays[this.weekdays.length - 1]).timeStampUtc.endOfDay,
            weekNumber: this.activeWeek,
        };
        this.updated.emit(this.timeTableUIData);
        this.renderDayOfWeek();
    }
    changeMonthYear() {
        const newDate = `${this.year}-${this.month}-01`;
        this.handleDatetime(newDate);
    }
    generateBasicDate() {
        this.daynamesOfWeek.forEach((day) => {
            this.timeTableData[day] = {
                items: [],
            };
        });
    }
    renderDayOfWeek() {
        this.schedules = this.weekdays.reduce((prev, current) => ({ ...prev, [current]: current }), {});
    }
    onChangeSchedules() {
        console.log('data:', this.data);
        this.weekdays.forEach((day) => {
            const slotsOfDay = this.data.filter((slot) => this.tadaNgxCalendarHelper.inDay(slot.startTime, day));
            this.timeTableData[day] = {
                items: _.orderBy(slotsOfDay, ['order']),
            };
        });
    }
    getLessonByOrder(day, index) {
        return this.timeTableData[day]?.items.filter((item) => item.order === index && item.timeShift == this.timeShift);
    }
}
CalendarComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: CalendarComponent, deps: [{ token: i1.TadaNgxCalendarHelper }, { token: i2.TranslateService }], target: i0.ɵɵFactoryTarget.Component });
CalendarComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: CalendarComponent, selector: "tada-ngx-calendar", inputs: { startRowTitles: "startRowTitles", month: "month", year: "year", data: "data", hideHeader: "hideHeader", timeShift: "timeShift" }, outputs: { updated: "updated" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"header-timetable-working\" *ngIf=\"!hideHeader\">\n    <div class=\"d-flex justify-content-between\">\n        <div class=\"timetableui-active-weeknum\">\n          Tu\u1EA7n {{ timeTableUIData?.weekNumber }} th\u00E1ng {{month}} n\u0103m {{ startDayOfWeek | date: 'yyyy' }}\n        </div>\n        <div>\n          <tada-ngx-calendar-navigation\n            (naviChange)=\"onChangeDirection($event)\"\n          ></tada-ngx-calendar-navigation>\n        </div>\n    </div>\n  </div>\n  \n  <h4 class=\"timeshift_title\">{{ timeShift | translate }}</h4>\n  \n  <div class=\"tada-ngx-calendar\">\n    <div class=\"tada-ngx-calendar-wrap-scroll\">\n      <div id=\"tada-ngx-calendar-calendar\">\n        <div class=\"tada-ngx-calendar-prefix-column tada-ngx-calendar-day-column\">\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"!hideHeader\">\n              <div>\n                <span></span>\n              </div>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item pre-label-column-value\"\n              *ngFor=\"let title of startRowTitles\"\n            >\n              <div>\n                <span>{{ title }}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div\n          *ngFor=\"let day of objectKeys(schedules); index as i\"\n          class=\"tada-ngx-calendar-day-column\"\n        >\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"!hideHeader\">\n              <p>{{ daynamesOfWeek[i] | translate }}</p>\n              <h4>{{ day | date: 'd' }}</h4>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item\"\n              *ngFor=\"let lessonNum of lessionNumOfDay\"\n            >\n              <div class=\"timetable-cell-block\">\n                <div\n                  *ngFor=\"let lession of getLessonByOrder(day, lessonNum+1)\"\n                  class=\"tada-ngx-calendar-day-schedule-item__item\"\n                >\n                  <timetable-cell [schedule]=\"lession\"></timetable-cell>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  ", styles: [".tada-ngx-calendar-prefix-column{width:100px!important}.tada-ngx-calendar-prefix-column span{display:block;width:100px!important}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-name{height:91px}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item span{font-weight:600;font-size:12px;line-height:12px;text-align:center;color:#b4b7c6}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item:first-child:not(.pre-label-column-value)>div{border-top:none;height:87px}.tada-ngx-calendar-wrap-scroll{overflow:auto;display:flex}#tada-ngx-calendar-calendar{display:flex;flex-direction:row;flex:1;padding-right:180px;min-width:86vw;justify-content:space-between;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name{text-align:center;padding:16px 8px;width:100%;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name p{font-weight:600;font-size:12px;line-height:12px;color:#b4b7c6}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name h4{font-style:normal;font-weight:600;font-size:24px;line-height:29px;margin:0;color:#000}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column{width:100%}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession{display:flex;flex-direction:column}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div{padding:5px 10px;font-weight:600;font-size:14px;display:block;line-height:20px;width:100%;text-align:center;color:#000;border:1px solid #e2e8f0;align-items:center;justify-content:center;display:flex;height:60px;flex-direction:column;gap:5px}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item h4{width:100%;overflow:hidden;text-overflow:ellipsis;margin:0;font-size:.85rem}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item .timetable_tutor_name{font-weight:400;font-size:14px;line-height:20px;text-align:center;font-style:normal;color:#737579}.timetable-cell-block{min-width:160px}.tada-ngx-calendar-day-schedule-item__item{display:block;width:100%}.tada-ngx-calendar-direction-controls{display:flex;flex-direction:row;font-weight:700;font-size:16px;line-height:18px;text-align:center;color:#000;gap:35px;align-items:center;margin-bottom:10px}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control{cursor:pointer}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control:not(.can_navigate_to){cursor:not-allowed;opacity:.57}.tada-ngx-calendar-direction-controls .active_class_name{font-weight:700;font-size:16px;white-space:nowrap;max-width:300px;overflow:hidden;text-overflow:ellipsis;line-height:18px;text-align:center;color:#000}timetable-cell{display:block;width:100%}h4.timeshift_title{font-style:normal;font-weight:400;font-size:14px;line-height:18px;color:#000;margin-bottom:5px}\n"], dependencies: [{ kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.TadaNgxCalendarCellComponent, selector: "timetable-cell", inputs: ["schedule"] }, { kind: "component", type: i5.TadaNgxCalendarUICalendarNaviComponent, selector: "tada-ngx-calendar-navigation", inputs: ["viewName"], outputs: ["naviChange"] }, { kind: "pipe", type: i3.DatePipe, name: "date" }, { kind: "pipe", type: i2.TranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: CalendarComponent, decorators: [{
            type: Component,
            args: [{ selector: 'tada-ngx-calendar', template: "<div class=\"header-timetable-working\" *ngIf=\"!hideHeader\">\n    <div class=\"d-flex justify-content-between\">\n        <div class=\"timetableui-active-weeknum\">\n          Tu\u1EA7n {{ timeTableUIData?.weekNumber }} th\u00E1ng {{month}} n\u0103m {{ startDayOfWeek | date: 'yyyy' }}\n        </div>\n        <div>\n          <tada-ngx-calendar-navigation\n            (naviChange)=\"onChangeDirection($event)\"\n          ></tada-ngx-calendar-navigation>\n        </div>\n    </div>\n  </div>\n  \n  <h4 class=\"timeshift_title\">{{ timeShift | translate }}</h4>\n  \n  <div class=\"tada-ngx-calendar\">\n    <div class=\"tada-ngx-calendar-wrap-scroll\">\n      <div id=\"tada-ngx-calendar-calendar\">\n        <div class=\"tada-ngx-calendar-prefix-column tada-ngx-calendar-day-column\">\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"!hideHeader\">\n              <div>\n                <span></span>\n              </div>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item pre-label-column-value\"\n              *ngFor=\"let title of startRowTitles\"\n            >\n              <div>\n                <span>{{ title }}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div\n          *ngFor=\"let day of objectKeys(schedules); index as i\"\n          class=\"tada-ngx-calendar-day-column\"\n        >\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"!hideHeader\">\n              <p>{{ daynamesOfWeek[i] | translate }}</p>\n              <h4>{{ day | date: 'd' }}</h4>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item\"\n              *ngFor=\"let lessonNum of lessionNumOfDay\"\n            >\n              <div class=\"timetable-cell-block\">\n                <div\n                  *ngFor=\"let lession of getLessonByOrder(day, lessonNum+1)\"\n                  class=\"tada-ngx-calendar-day-schedule-item__item\"\n                >\n                  <timetable-cell [schedule]=\"lession\"></timetable-cell>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  ", styles: [".tada-ngx-calendar-prefix-column{width:100px!important}.tada-ngx-calendar-prefix-column span{display:block;width:100px!important}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-name{height:91px}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item span{font-weight:600;font-size:12px;line-height:12px;text-align:center;color:#b4b7c6}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item:first-child:not(.pre-label-column-value)>div{border-top:none;height:87px}.tada-ngx-calendar-wrap-scroll{overflow:auto;display:flex}#tada-ngx-calendar-calendar{display:flex;flex-direction:row;flex:1;padding-right:180px;min-width:86vw;justify-content:space-between;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name{text-align:center;padding:16px 8px;width:100%;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name p{font-weight:600;font-size:12px;line-height:12px;color:#b4b7c6}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name h4{font-style:normal;font-weight:600;font-size:24px;line-height:29px;margin:0;color:#000}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column{width:100%}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession{display:flex;flex-direction:column}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div{padding:5px 10px;font-weight:600;font-size:14px;display:block;line-height:20px;width:100%;text-align:center;color:#000;border:1px solid #e2e8f0;align-items:center;justify-content:center;display:flex;height:60px;flex-direction:column;gap:5px}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item h4{width:100%;overflow:hidden;text-overflow:ellipsis;margin:0;font-size:.85rem}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item .timetable_tutor_name{font-weight:400;font-size:14px;line-height:20px;text-align:center;font-style:normal;color:#737579}.timetable-cell-block{min-width:160px}.tada-ngx-calendar-day-schedule-item__item{display:block;width:100%}.tada-ngx-calendar-direction-controls{display:flex;flex-direction:row;font-weight:700;font-size:16px;line-height:18px;text-align:center;color:#000;gap:35px;align-items:center;margin-bottom:10px}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control{cursor:pointer}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control:not(.can_navigate_to){cursor:not-allowed;opacity:.57}.tada-ngx-calendar-direction-controls .active_class_name{font-weight:700;font-size:16px;white-space:nowrap;max-width:300px;overflow:hidden;text-overflow:ellipsis;line-height:18px;text-align:center;color:#000}timetable-cell{display:block;width:100%}h4.timeshift_title{font-style:normal;font-weight:400;font-size:14px;line-height:18px;color:#000;margin-bottom:5px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.TadaNgxCalendarHelper }, { type: i2.TranslateService }]; }, propDecorators: { startRowTitles: [{
                type: Input
            }], month: [{
                type: Input
            }], year: [{
                type: Input
            }], updated: [{
                type: Output
            }], data: [{
                type: Input
            }], hideHeader: [{
                type: Input
            }], timeShift: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvY2FsZW5kYXIvc3JjL2xpYi9jYWxlbmRhci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9jYWxlbmRhci9zcmMvbGliL2NhbGVuZGFyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxTQUFTLEVBRVQsWUFBWSxFQUNaLEtBQUssRUFHTCxNQUFNLEdBR1AsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxLQUFLLENBQUMsTUFBTSxRQUFRLENBQUM7QUFDNUIsT0FBTyxFQUNMLDJCQUEyQixFQUMzQixhQUFhLEdBQ2QsTUFBTSxhQUFhLENBQUM7Ozs7Ozs7QUFZckIsTUFBTSxPQUFPLGlCQUFpQjtJQXNCNUIsWUFDVSxxQkFBNEMsRUFDNUMsU0FBMkI7UUFEM0IsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUF1QjtRQUM1QyxjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQXRCckMsb0JBQWUsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFFOUIsbUJBQWMsR0FBYSxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDakQsVUFBSyxHQUFXLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUM3RCxTQUFJLEdBQVksSUFBSSxDQUFDLHFCQUFxQixDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzFELFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzlCLFNBQUksR0FBUSxJQUFJLENBQUM7UUFDakIsZUFBVSxHQUFRLElBQUksQ0FBQztRQUN2QixjQUFTLEdBQVEsSUFBSSxDQUFDO1FBRS9CLG1CQUFjLEdBQUcsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxDQUFDO1FBQ3BDLGtCQUFhLEdBQVEsRUFBRSxD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QztZQUNGLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEdBQUc7Z0JBQ3hCLEtBQUssRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQ3hDLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxnQkFBZ0IsQ0FBQyxHQUFXLEVBQUUsS0FBYTtRQUN6QyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FDMUMsQ0FBQyxJQUFTLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxJQUFJLElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FDeEUsQ0FBQztJQUNKLENBQUM7OzhHQXRLVSxpQkFBaUI7a0dBQWpCLGlCQUFpQiwyUEM1QjlCLHV6RUE4REU7MkZEbENXLGlCQUFpQjtrQkFQN0IsU0FBUzsrQkFDRSxtQkFBbUI7MklBVXBCLGNBQWM7c0JBQXRCLEtBQUs7Z0JBQ0csS0FBSztzQkFBYixLQUFLO2dCQUNHLElBQUk7c0JBQVosS0FBSztnQkFDSSxPQUFPO3NCQUFoQixNQUFNO2dCQUNFLElBQUk7c0JBQVosS0FBSztnQkFDRyxVQUFVO3NCQUFsQixLQUFLO2dCQUNHLFNBQVM7c0JBQWpCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBEb0NoZWNrLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2VzLFxuICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHtcbiAgVElNRVRBQkxFX0NIQU5HRV9ESVJFQ1RJT05TLFxuICB3ZWVrRGF5TGFiZWxzLFxufSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBDYWxlbmRhclR5cGUgfSBmcm9tICcuL3R5cGluZ3MnO1xuaW1wb3J0IHsgVGFkYU5neENhbGVuZGFySGVscGVyIH0gZnJvbSAnLi9jYWxlbmRhci5oZWxwZXInO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0YWRhLW5neC1jYWxlbmRhcicsXG4gIHRlbXBsYXRlVXJsOiBgY2FsZW5kYXIuY29tcG9uZW50Lmh0bWxgLFxuICBzdHlsZVVybHM6IFtcbiAgICAnY2FsZW5kYXIuY29tcG9uZW50LnNjc3MnXG4gIF1cbn0pXG5leHBvcnQgY2xhc3MgQ2FsZW5kYXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIERvQ2hlY2sge1xuICBcbiAgbGVzc2lvbk51bU9mRGF5ID0gWy4uLkFycmF5KDUpLmtleXMoKV07XG5cbiAgQElucHV0KCkgc3RhcnRSb3dUaXRsZXM6IHN0cmluZ1tdID0gdGhpcy5idWlsZFJvd1RpdGxlcygpO1xuICBASW5wdXQoKSBtb250aDogbnVtYmVyID0gdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuZ2V0Q3VycmVudE1vbnRoKCk7XG4gIEBJbnB1dCgpIHllYXI6IG51bWJlciAgPSB0aGlzLnRhZGFOZ3hDYWxlbmRhckhlbHBlci5nZXRBY3RpdmVZZWFyKCk7XG4gIEBPdXRwdXQoKSB1cGRhdGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBASW5wdXQoKSBkYXRhOiBhbnkgPSBudWxsO1xuICBASW5wdXQoKSBoaWRlSGVhZGVyOiBhbnkgPSBudWxsO1xuICBASW5wdXQoKSB0aW1lU2hpZnQ6IGFueSA9IG51bGw7XG5cbiAgZGF5bmFtZXNPZldlZWsgPSBbLi4ud2Vla0RheUxhYmVsc107XG4gIHRpbWVUYWJsZURhdGE6IGFueSA9IHt9O1xuICBvYmplY3RLZXlzID0gT2JqZWN0LmtleXM7XG4gIHdlZWtkYXlzOiBhbnlbXSA9IFtdO1xuICBzY2hlZHVsZXM6IGFueSA9IHt9O1xuICB0aW1lVGFibGVVSURhdGE6IENhbGVuZGFyVHlwZSA9IHt9O1xuICBhY3RpdmVXZWVrOiBudW1iZXIgPSAwO1xuICB0b3RhbFdlZWtPZlllYXIgPSAwO1xuICBzdGFydERheU9mV2VlazogYW55ID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHRhZGFOZ3hDYWxlbmRhckhlbHBlcjogVGFkYU5neENhbGVuZGFySGVscGVyLFxuICAgIHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlXG4gICkge1xuICAgIHRoaXMudHJhbnNsYXRlLnNldERlZmF1bHRMYW5nKCd2bicpO1xuICAgIHRoaXMuYnVpbGRSb3dUaXRsZXMoKTtcbiAgfVxuXG4gIG5nRG9DaGVjaygpOiB2b2lkIHt9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIFxuICAgIGlmIChjaGFuZ2VzWydkYXRhJ10/LmN1cnJlbnRWYWx1ZSAmJiBjaGFuZ2VzWydkYXRhJ10/LmN1cnJlbnRWYWx1ZS5sZW5ndGgpIHtcbiAgICAgIHRoaXMub25DaGFuZ2VTY2hlZHVsZXMoKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICBjaGFuZ2VzWydtb250aCddPy5maXJzdENoYW5nZSAmJlxuICAgICAgY2hhbmdlc1snbW9udGgnXS5jdXJyZW50VmFsdWUgJiZcbiAgICAgIGNoYW5nZXNbJ3llYXInXT8uZmlyc3RDaGFuZ2UgJiZcbiAgICAgIGNoYW5nZXNbJ3llYXInXS5jdXJyZW50VmFsdWVcbiAgICApIHtcbiAgICAgIHRoaXMuYWN0aXZlV2VlayA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmN1cnJlbnRXZWVrTnVtYmVyKCk7XG4gICAgICB0aGlzLnRvdGFsV2Vla09mWWVhciA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmlzb1dlZWtzSW5ZZWFyKHRoaXMueWVhcik7XG4gICAgICB0aGlzLm9uQ2hhbmdlRGlyZWN0aW9uKFRJTUVUQUJMRV9DSEFOR0VfRElSRUNUSU9OUy5NT1ZFX1RPREFZKTtcbiAgICB9IGVsc2UgaWYgKGNoYW5nZXNbJ21vbnRoJ10/LmN1cnJlbnRWYWx1ZSB8fCBjaGFuZ2VzWyd5ZWFyJ10/LmN1cnJlbnRWYWx1ZSkge1xuICAgICAgdGhpcy5jaGFuZ2VNb250aFllYXIoKTtcbiAgICB9XG5cbiAgfVxuXG4gIGJ1aWxkUm93VGl0bGVzKCkge1xuICAgIHJldHVybiB0aGlzLmxlc3Npb25OdW1PZkRheS5tYXAoXG4gICAgICAoXywgaW5kZXg6IG51bWJlcikgPT4gYFRp4bq/dCAke2luZGV4ICsgMX1gXG4gICAgKTtcbiAgfVxuXG4gIG9uQ2hhbmdlRGlyZWN0aW9uKGFjdGlvbjogc3RyaW5nKSB7XG4gICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgIGNhc2UgVElNRVRBQkxFX0NIQU5HRV9ESVJFQ1RJT05TLk1PVkVfUFJFVjpcbiAgICAgICAgdGhpcy5nb1ByZXZpb3VzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBUSU1FVEFCTEVfQ0hBTkdFX0RJUkVDVElPTlMuTU9WRV9ORVhUOlxuICAgICAgICB0aGlzLmdvTmV4dCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVElNRVRBQkxFX0NIQU5HRV9ESVJFQ1RJT05TLk1PVkVfVE9EQVk6XG4gICAgICAgIHRoaXMudG9kYXkoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5oYW5kbGVEYXRldGltZSh0aGlzLnN0YXJ0RGF5T2ZXZWVrKTtcbiAgfVxuXG4gIGNhbkdvUHJldmlvdXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZlV2VlayA8IHRoaXMudG90YWxXZWVrT2ZZZWFyO1xuICB9XG5cbiAgY2FuR29OZXh0KCkge1xuICAgIHJldHVybiB0aGlzLmFjdGl2ZVdlZWsgPCB0aGlzLnRvdGFsV2Vla09mWWVhcjtcbiAgfVxuXG4gIGdvUHJldmlvdXMoKSB7XG4gICAgdGhpcy5zdGFydERheU9mV2VlayA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLnN1YnRyYWN0KFxuICAgICAgdGhpcy5zdGFydERheU9mV2Vla1xuICAgICk7XG4gIH1cblxuICBnb05leHQoKSB7XG4gICAgdGhpcy5zdGFydERheU9mV2VlayA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmFkZCh0aGlzLnN0YXJ0RGF5T2ZXZWVrKTtcbiAgfVxuXG4gIHRvZGF5KCkge1xuICAgIGNvbnN0IGN1cnJlbnRXZWVrID0gdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuY3VycmVudFdlZWtOdW1iZXIoKTtcbiAgICB0aGlzLnN0YXJ0RGF5T2ZXZWVrID0gdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuZGF5U3RhcnRPZldlZWsoXG4gICAgICBjdXJyZW50V2VlayxcbiAgICAgIHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmdldEN1cnJlbnRZZWFyKClcbiAgICApO1xuICB9XG5cbiAgaGFuZGxlRGF0ZXRpbWUoZnJvbURhdGU6IHN0cmluZykge1xuICAgIHRoaXMud2Vla2RheXMgPSB0aGlzLnRhZGFOZ3hDYWxlbmRhckhlbHBlci5nZXRXZWVrRGF5c0J5RGF5KGZyb21EYXRlKTtcbiAgICB0aGlzLmFjdGl2ZVdlZWsgPSB0aGlzLnRhZGFOZ3hDYWxlbmRhckhlbHBlci5nZXRXZWVrTnVtYmVyQnlEYXRlKFxuICAgICAgdGhpcy53ZWVrZGF5c1swXVxuICAgICk7XG4gICAgY29uc3QgW3llYXIsIG1vbnRoXSA9IGZyb21EYXRlLnNwbGl0KCctJyk7XG5cbiAgICB0aGlzLm1vbnRoID0gK21vbnRoO1xuICAgIHRoaXMueWVhciA9ICt5ZWFyO1xuXG4gICAgdGhpcy5zdGFydERheU9mV2VlayA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmRheVN0YXJ0T2ZXZWVrKFxuICAgICAgdGhpcy5hY3RpdmVXZWVrLFxuICAgICAgdGhpcy55ZWFyXG4gICAgKTtcbiAgICB0aGlzLnRpbWVUYWJsZVVJRGF0YSA9IHtcbiAgICAgIHN0YXJ0RGF0ZTogdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuZ2V0VGltZVJhbmdlKHRoaXMud2Vla2RheXNbMF0pXG4gICAgICAgIC50aW1lU3RhbXBVdGMuc3RhcnRPZkRheSxcbiAgICAgIGVuZERhdGU6IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmdldFRpbWVSYW5nZShcbiAgICAgICAgdGhpcy53ZWVrZGF5c1t0aGlzLndlZWtkYXlzLmxlbmd0aCAtIDFdXG4gICAgICApLnRpbWVTdGFtcFV0Yy5lbmRPZkRheSxcbiAgICAgIHdlZWtOdW1iZXI6IHRoaXMuYWN0aXZlV2VlayxcbiAgICB9O1xuXG4gICAgdGhpcy51cGRhdGVkLmVtaXQodGhpcy50aW1lVGFibGVVSURhdGEpO1xuICAgIHRoaXMucmVuZGVyRGF5T2ZXZWVrKCk7XG4gIH1cblxuICBjaGFuZ2VNb250aFllYXIoKSB7XG4gICAgY29uc3QgbmV3RGF0ZSA9IGAke3RoaXMueWVhcn0tJHt0aGlzLm1vbnRofS0wMWA7XG4gICAgdGhpcy5oYW5kbGVEYXRldGltZShuZXdEYXRlKTtcbiAgfVxuXG4gIGdlbmVyYXRlQmFzaWNEYXRlKCkge1xuICAgIHRoaXMuZGF5bmFtZXNPZldlZWsuZm9yRWFjaCgoZGF5OiBzdHJpbmcpID0+IHtcbiAgICAgIHRoaXMudGltZVRhYmxlRGF0YVtkYXldID0ge1xuICAgICAgICBpdGVtczogW10sXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgcmVuZGVyRGF5T2ZXZWVrKCkge1xuICAgIHRoaXMuc2NoZWR1bGVzID0gdGhpcy53ZWVrZGF5cy5yZWR1Y2UoXG4gICAgICAocHJldjogYW55LCBjdXJyZW50OiBhbnkpID0+ICh7IC4uLnByZXYsIFtjdXJyZW50XTogY3VycmVudCB9KSxcbiAgICAgIHt9XG4gICAgKTtcbiAgfVxuXG4gIG9uQ2hhbmdlU2NoZWR1bGVzKCkge1xuICAgIGNvbnNvbGUubG9nKCdkYXRhOicsIHRoaXMuZGF0YSk7XG4gICAgdGhpcy53ZWVrZGF5cy5mb3JFYWNoKChkYXkpID0+IHtcbiAgICAgIGNvbnN0IHNsb3RzT2ZEYXkgPSB0aGlzLmRhdGEuZmlsdGVyKChzbG90OiBhbnkpID0+XG4gICAgICAgIHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmluRGF5KHNsb3Quc3RhcnRUaW1lLCBkYXkpXG4gICAgICApO1xuICAgICAgdGhpcy50aW1lVGFibGVEYXRhW2RheV0gPSB7XG4gICAgICAgIGl0ZW1zOiBfLm9yZGVyQnkoc2xvdHNPZkRheSwgWydvcmRlciddKSxcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBnZXRMZXNzb25CeU9yZGVyKGRheTogc3RyaW5nLCBpbmRleDogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXMudGltZVRhYmxlRGF0YVtkYXldPy5pdGVtcy5maWx0ZXIoXG4gICAgICAoaXRlbTogYW55KSA9PiBpdGVtLm9yZGVyID09PSBpbmRleCAmJiBpdGVtLnRpbWVTaGlmdCA9PSB0aGlzLnRpbWVTaGlmdFxuICAgICk7XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJoZWFkZXItdGltZXRhYmxlLXdvcmtpbmdcIiAqbmdJZj1cIiFoaWRlSGVhZGVyXCI+XG4gICAgPGRpdiBjbGFzcz1cImQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlblwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwidGltZXRhYmxldWktYWN0aXZlLXdlZWtudW1cIj5cbiAgICAgICAgICBUdeG6p24ge3sgdGltZVRhYmxlVUlEYXRhPy53ZWVrTnVtYmVyIH19IHRow6FuZyB7e21vbnRofX0gbsSDbSB7eyBzdGFydERheU9mV2VlayB8IGRhdGU6ICd5eXl5JyB9fVxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdj5cbiAgICAgICAgICA8dGFkYS1uZ3gtY2FsZW5kYXItbmF2aWdhdGlvblxuICAgICAgICAgICAgKG5hdmlDaGFuZ2UpPVwib25DaGFuZ2VEaXJlY3Rpb24oJGV2ZW50KVwiXG4gICAgICAgICAgPjwvdGFkYS1uZ3gtY2FsZW5kYXItbmF2aWdhdGlvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuICBcbiAgPGg0IGNsYXNzPVwidGltZXNoaWZ0X3RpdGxlXCI+e3sgdGltZVNoaWZ0IHwgdHJhbnNsYXRlIH19PC9oND5cbiAgXG4gIDxkaXYgY2xhc3M9XCJ0YWRhLW5neC1jYWxlbmRhclwiPlxuICAgIDxkaXYgY2xhc3M9XCJ0YWRhLW5neC1jYWxlbmRhci13cmFwLXNjcm9sbFwiPlxuICAgICAgPGRpdiBpZD1cInRhZGEtbmd4LWNhbGVuZGFyLWNhbGVuZGFyXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0YWRhLW5neC1jYWxlbmRhci1wcmVmaXgtY29sdW1uIHRhZGEtbmd4LWNhbGVuZGFyLWRheS1jb2x1bW5cIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItZGF5LWNvbHVtbi1sZXNzaW9uXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItZGF5LW5hbWVcIiAqbmdJZj1cIiFoaWRlSGVhZGVyXCI+XG4gICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgPHNwYW4+PC9zcGFuPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICBjbGFzcz1cInRhZGEtbmd4LWNhbGVuZGFyLWRheS1sZXNzaW9uLWl0ZW0gcHJlLWxhYmVsLWNvbHVtbi12YWx1ZVwiXG4gICAgICAgICAgICAgICpuZ0Zvcj1cImxldCB0aXRsZSBvZiBzdGFydFJvd1RpdGxlc1wiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgPHNwYW4+e3sgdGl0bGUgfX08L3NwYW4+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgKm5nRm9yPVwibGV0IGRheSBvZiBvYmplY3RLZXlzKHNjaGVkdWxlcyk7IGluZGV4IGFzIGlcIlxuICAgICAgICAgIGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItZGF5LWNvbHVtblwiXG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItZGF5LWNvbHVtbi1sZXNzaW9uXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItZGF5LW5hbWVcIiAqbmdJZj1cIiFoaWRlSGVhZGVyXCI+XG4gICAgICAgICAgICAgIDxwPnt7IGRheW5hbWVzT2ZXZWVrW2ldIHwgdHJhbnNsYXRlIH19PC9wPlxuICAgICAgICAgICAgICA8aDQ+e3sgZGF5IHwgZGF0ZTogJ2QnIH19PC9oND5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICBjbGFzcz1cInRhZGEtbmd4LWNhbGVuZGFyLWRheS1sZXNzaW9uLWl0ZW1cIlxuICAgICAgICAgICAgICAqbmdGb3I9XCJsZXQgbGVzc29uTnVtIG9mIGxlc3Npb25OdW1PZkRheVwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0aW1ldGFibGUtY2VsbC1ibG9ja1wiPlxuICAgICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAgICpuZ0Zvcj1cImxldCBsZXNzaW9uIG9mIGdldExlc3NvbkJ5T3JkZXIoZGF5LCBsZXNzb25OdW0rMSlcIlxuICAgICAgICAgICAgICAgICAgY2xhc3M9XCJ0YWRhLW5neC1jYWxlbmRhci1kYXktc2NoZWR1bGUtaXRlbV9faXRlbVwiXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgPHRpbWV0YWJsZS1jZWxsIFtzY2hlZHVsZV09XCJsZXNzaW9uXCI+PC90aW1ldGFibGUtY2VsbD5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gICJdfQ==