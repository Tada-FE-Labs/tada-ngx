import { Component, EventEmitter, Input, Output } from '@angular/core';
import * as _ from 'lodash';
import { TIMETABLE_CHANGE_DIRECTIONS, weekDayLabels, } from './constants';
import * as i0 from "@angular/core";
import * as i1 from "./calendar.helper";
import * as i2 from "@ngx-translate/core";
import * as i3 from "@angular/common";
import * as i4 from "./components/timetable-cell/timetable-cell.component";
import * as i5 from "./components/calendar-navi/calendar-navi.component";
export class CalendarComponent {
    constructor(tadaNgxCalendarHelper, translate) {
        this.tadaNgxCalendarHelper = tadaNgxCalendarHelper;
        this.translate = translate;
        this.lessionNumOfDay = [...Array(5).keys()];
        this.startRowTitles = this.buildRowTitles();
        this.month = this.tadaNgxCalendarHelper.getCurrentMonth();
        this.year = this.tadaNgxCalendarHelper.getActiveYear();
        this.updated = new EventEmitter();
        this.data = null;
        this.hideHeader = null;
        this.timeShift = null;
        this.onChangeOnOffSwitch = new EventEmitter();
        this.scheduleOpened = new EventEmitter();
        this.daynamesOfWeek = [...weekDayLabels];
        this.timeTableData = {};
        this.objectKeys = Object.keys;
        this.weekdays = [];
        this.schedules = {};
        this.timeTableUIData = {};
        this.activeWeek = 0;
        this.totalWeekOfYear = 0;
        this.startDayOfWeek = null;
        this.translate.setDefaultLang('vn');
        this.buildRowTitles();
    }
    ngDoCheck() { }
    ngOnChanges(changes) {
        console.log({ changes });
        if (changes['data']?.currentValue && changes['data']?.currentValue.length) {
            this.onChangeSchedules();
        }
        if (changes['month']?.firstChange &&
            changes['month'].currentValue &&
            changes['year']?.firstChange &&
            changes['year'].currentValue) {
            this.activeWeek = this.tadaNgxCalendarHelper.currentWeekNumber();
            this.totalWeekOfYear = this.tadaNgxCalendarHelper.isoWeeksInYear(this.year);
            this.onChangeDirection(TIMETABLE_CHANGE_DIRECTIONS.MOVE_TODAY);
        }
        else if (changes['month']?.currentValue || changes['year']?.currentValue) {
            this.changeMonthYear();
        }
    }
    buildRowTitles() {
        return this.lessionNumOfDay.map((_, index) => `Tiết ${index + 1}`);
    }
    onChangeDirection(action) {
        switch (action) {
            case TIMETABLE_CHANGE_DIRECTIONS.MOVE_PREV:
                this.goPrevious();
                break;
            case TIMETABLE_CHANGE_DIRECTIONS.MOVE_NEXT:
                this.goNext();
                break;
            case TIMETABLE_CHANGE_DIRECTIONS.MOVE_TODAY:
                this.today();
                break;
            default:
                return;
        }
        this.handleDatetime(this.startDayOfWeek);
    }
    canGoPrevious() {
        return this.activeWeek < this.totalWeekOfYear;
    }
    canGoNext() {
        return this.activeWeek < this.totalWeekOfYear;
    }
    goPrevious() {
        this.startDayOfWeek = this.tadaNgxCalendarHelper.subtract(this.startDayOfWeek);
    }
    goNext() {
        this.startDayOfWeek = this.tadaNgxCalendarHelper.add(this.startDayOfWeek);
    }
    today() {
        const currentWeek = this.tadaNgxCalendarHelper.currentWeekNumber();
        this.startDayOfWeek = this.tadaNgxCalendarHelper.dayStartOfWeek(currentWeek, this.tadaNgxCalendarHelper.getCurrentYear());
    }
    handleDatetime(fromDate) {
        this.weekdays = this.tadaNgxCalendarHelper.getWeekDaysByDay(fromDate);
        this.activeWeek = this.tadaNgxCalendarHelper.getWeekNumberByDate(this.weekdays[0]);
        const [year, month] = fromDate.split('-');
        this.month = +month;
        this.year = +year;
        this.startDayOfWeek = this.tadaNgxCalendarHelper.dayStartOfWeek(this.activeWeek, this.year);
        this.timeTableUIData = {
            startDate: this.tadaNgxCalendarHelper.getTimeRange(this.weekdays[0])
                .timeStampUtc.startOfDay,
            endDate: this.tadaNgxCalendarHelper.getTimeRange(this.weekdays[this.weekdays.length - 1]).timeStampUtc.endOfDay,
            weekNumber: this.activeWeek,
        };
        this.updated.emit(this.timeTableUIData);
        this.renderDayOfWeek();
    }
    changeMonthYear() {
        const newDate = `${this.year}-${this.month}-01`;
        this.handleDatetime(newDate);
    }
    generateBasicDate() {
        this.daynamesOfWeek.forEach((day) => {
            this.timeTableData[day] = {
                items: [],
            };
        });
    }
    renderDayOfWeek() {
        this.schedules = this.weekdays.reduce((prev, current) => ({ ...prev, [current]: current }), {});
    }
    onChangeSchedules() {
        this.weekdays.forEach((day) => {
            const slotsOfDay = this.data.filter((slot) => this.tadaNgxCalendarHelper.inDay(slot.startTime, day));
            this.timeTableData[day] = {
                items: _.orderBy(slotsOfDay, ['order']),
            };
        });
    }
    getLessonByOrder(day, index) {
        const found = this.timeTableData[day]?.items.filter((item) => item.order === index && item.timeShift == this.timeShift);
        return found;
    }
}
CalendarComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: CalendarComponent, deps: [{ token: i1.TadaNgxCalendarHelper }, { token: i2.TranslateService }], target: i0.ɵɵFactoryTarget.Component });
CalendarComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: CalendarComponent, selector: "tada-ngx-calendar", inputs: { startRowTitles: "startRowTitles", month: "month", year: "year", data: "data", hideHeader: "hideHeader", timeShift: "timeShift", lessionUnit: "lessionUnit", userType: "userType", isBOSide: "isBOSide" }, outputs: { updated: "updated", onChangeOnOffSwitch: "onChangeOnOffSwitch", scheduleOpened: "scheduleOpened" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"header-timetable-working\" *ngIf=\"!hideHeader\">\n    <div class=\"d-flex justify-content-between\">\n        <div class=\"timetableui-active-weeknum\">\n          Tu\u1EA7n {{ timeTableUIData?.weekNumber }} th\u00E1ng {{month}} n\u0103m {{ startDayOfWeek | date: 'yyyy' }}\n        </div>\n        <div>\n          <tada-ngx-calendar-navigation\n            (naviChange)=\"onChangeDirection($event)\"\n          ></tada-ngx-calendar-navigation>\n        </div>\n    </div>\n  </div>\n  \n  <h4 class=\"timeshift_title\">{{ timeShift | translate }}</h4>\n  \n  <div class=\"tada-ngx-calendar\">\n    <div class=\"tada-ngx-calendar-wrap-scroll\">\n      <div id=\"tada-ngx-calendar-calendar\">\n        <div class=\"tada-ngx-calendar-prefix-column tada-ngx-calendar-day-column\">\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"!hideHeader\">\n              <div>\n                <span></span>\n              </div>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item pre-label-column-value\"\n              *ngFor=\"let title of startRowTitles\"\n            >\n              <div>\n                <span>{{ title }}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div\n          *ngFor=\"let day of objectKeys(schedules); index as i\"\n          class=\"tada-ngx-calendar-day-column\"\n        >\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"!hideHeader\">\n              <p>{{ daynamesOfWeek[i] | translate }}</p>\n              <h4>{{ day | date: 'd' }}</h4>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item\"\n              *ngFor=\"let lessonNum of lessionNumOfDay\"\n            >\n              <div class=\"timetable-cell-block\">\n                <div\n                  *ngFor=\"let lession of getLessonByOrder(day, lessonNum+1)\"\n                  class=\"tada-ngx-calendar-day-schedule-item__item\"\n                >\n                  <timetable-cell\n                  [userType]=\"userType\"\n                  [isBOSide]=\"isBOSide\"\n                  [lessionUnit]=\"lessionUnit\"\n                  (scheduleOpened)=\"scheduleOpened.emit($event)\"\n                  (onChangeOnOffSwitch)=\"onChangeOnOffSwitch.emit($event)\"\n                  [schedule]=\"lession\"></timetable-cell>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  ", styles: [".tada-ngx-calendar-prefix-column{width:100px!important}.tada-ngx-calendar-prefix-column span{display:block;width:100px!important}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-name{height:91px}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item span{font-weight:600;font-size:12px;line-height:12px;text-align:center;color:#b4b7c6}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item:first-child:not(.pre-label-column-value)>div{border-top:none;height:87px}.tada-ngx-calendar-wrap-scroll{overflow:auto;display:flex}#tada-ngx-calendar-calendar{display:flex;flex-direction:row;flex:1;padding-right:180px;min-width:86vw;justify-content:space-between;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name{text-align:center;padding:16px 8px;width:100%;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name p{font-weight:600;font-size:12px;line-height:12px;color:#b4b7c6}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name h4{font-style:normal;font-weight:600;font-size:24px;line-height:29px;margin:0;color:#000}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column{width:100%}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession{display:flex;flex-direction:column}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div{padding:5px 10px;font-weight:600;font-size:14px;display:block;line-height:20px;width:100%;text-align:center;color:#000;border:1px solid #e2e8f0;align-items:center;justify-content:center;display:flex;height:60px;flex-direction:column;gap:5px}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item h4{width:100%;overflow:hidden;text-overflow:ellipsis;margin:0;font-size:.85rem}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item .timetable_tutor_name{font-weight:400;font-size:14px;line-height:20px;text-align:center;font-style:normal;color:#737579}.timetable-cell-block{min-width:160px}.tada-ngx-calendar-day-schedule-item__item{display:block;width:100%}.tada-ngx-calendar-direction-controls{display:flex;flex-direction:row;font-weight:700;font-size:16px;line-height:18px;text-align:center;color:#000;gap:35px;align-items:center;margin-bottom:10px}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control{cursor:pointer}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control:not(.can_navigate_to){cursor:not-allowed;opacity:.57}.tada-ngx-calendar-direction-controls .active_class_name{font-weight:700;font-size:16px;white-space:nowrap;max-width:300px;overflow:hidden;text-overflow:ellipsis;line-height:18px;text-align:center;color:#000}timetable-cell{display:block;width:100%}h4.timeshift_title{font-style:normal;font-weight:400;font-size:14px;line-height:18px;color:#000;margin-bottom:5px}\n"], dependencies: [{ kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.TadaNgxCalendarCellComponent, selector: "timetable-cell", inputs: ["schedule", "lessionUnit", "userType", "isBOSide"], outputs: ["onChangeOnOffSwitch", "scheduleOpened"] }, { kind: "component", type: i5.TadaNgxCalendarUICalendarNaviComponent, selector: "tada-ngx-calendar-navigation", inputs: ["viewName"], outputs: ["naviChange"] }, { kind: "pipe", type: i3.DatePipe, name: "date" }, { kind: "pipe", type: i2.TranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: CalendarComponent, decorators: [{
            type: Component,
            args: [{ selector: 'tada-ngx-calendar', template: "<div class=\"header-timetable-working\" *ngIf=\"!hideHeader\">\n    <div class=\"d-flex justify-content-between\">\n        <div class=\"timetableui-active-weeknum\">\n          Tu\u1EA7n {{ timeTableUIData?.weekNumber }} th\u00E1ng {{month}} n\u0103m {{ startDayOfWeek | date: 'yyyy' }}\n        </div>\n        <div>\n          <tada-ngx-calendar-navigation\n            (naviChange)=\"onChangeDirection($event)\"\n          ></tada-ngx-calendar-navigation>\n        </div>\n    </div>\n  </div>\n  \n  <h4 class=\"timeshift_title\">{{ timeShift | translate }}</h4>\n  \n  <div class=\"tada-ngx-calendar\">\n    <div class=\"tada-ngx-calendar-wrap-scroll\">\n      <div id=\"tada-ngx-calendar-calendar\">\n        <div class=\"tada-ngx-calendar-prefix-column tada-ngx-calendar-day-column\">\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"!hideHeader\">\n              <div>\n                <span></span>\n              </div>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item pre-label-column-value\"\n              *ngFor=\"let title of startRowTitles\"\n            >\n              <div>\n                <span>{{ title }}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div\n          *ngFor=\"let day of objectKeys(schedules); index as i\"\n          class=\"tada-ngx-calendar-day-column\"\n        >\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"!hideHeader\">\n              <p>{{ daynamesOfWeek[i] | translate }}</p>\n              <h4>{{ day | date: 'd' }}</h4>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item\"\n              *ngFor=\"let lessonNum of lessionNumOfDay\"\n            >\n              <div class=\"timetable-cell-block\">\n                <div\n                  *ngFor=\"let lession of getLessonByOrder(day, lessonNum+1)\"\n                  class=\"tada-ngx-calendar-day-schedule-item__item\"\n                >\n                  <timetable-cell\n                  [userType]=\"userType\"\n                  [isBOSide]=\"isBOSide\"\n                  [lessionUnit]=\"lessionUnit\"\n                  (scheduleOpened)=\"scheduleOpened.emit($event)\"\n                  (onChangeOnOffSwitch)=\"onChangeOnOffSwitch.emit($event)\"\n                  [schedule]=\"lession\"></timetable-cell>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  ", styles: [".tada-ngx-calendar-prefix-column{width:100px!important}.tada-ngx-calendar-prefix-column span{display:block;width:100px!important}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-name{height:91px}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item span{font-weight:600;font-size:12px;line-height:12px;text-align:center;color:#b4b7c6}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item:first-child:not(.pre-label-column-value)>div{border-top:none;height:87px}.tada-ngx-calendar-wrap-scroll{overflow:auto;display:flex}#tada-ngx-calendar-calendar{display:flex;flex-direction:row;flex:1;padding-right:180px;min-width:86vw;justify-content:space-between;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name{text-align:center;padding:16px 8px;width:100%;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name p{font-weight:600;font-size:12px;line-height:12px;color:#b4b7c6}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name h4{font-style:normal;font-weight:600;font-size:24px;line-height:29px;margin:0;color:#000}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column{width:100%}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession{display:flex;flex-direction:column}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div{padding:5px 10px;font-weight:600;font-size:14px;display:block;line-height:20px;width:100%;text-align:center;color:#000;border:1px solid #e2e8f0;align-items:center;justify-content:center;display:flex;height:60px;flex-direction:column;gap:5px}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item h4{width:100%;overflow:hidden;text-overflow:ellipsis;margin:0;font-size:.85rem}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item .timetable_tutor_name{font-weight:400;font-size:14px;line-height:20px;text-align:center;font-style:normal;color:#737579}.timetable-cell-block{min-width:160px}.tada-ngx-calendar-day-schedule-item__item{display:block;width:100%}.tada-ngx-calendar-direction-controls{display:flex;flex-direction:row;font-weight:700;font-size:16px;line-height:18px;text-align:center;color:#000;gap:35px;align-items:center;margin-bottom:10px}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control{cursor:pointer}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control:not(.can_navigate_to){cursor:not-allowed;opacity:.57}.tada-ngx-calendar-direction-controls .active_class_name{font-weight:700;font-size:16px;white-space:nowrap;max-width:300px;overflow:hidden;text-overflow:ellipsis;line-height:18px;text-align:center;color:#000}timetable-cell{display:block;width:100%}h4.timeshift_title{font-style:normal;font-weight:400;font-size:14px;line-height:18px;color:#000;margin-bottom:5px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.TadaNgxCalendarHelper }, { type: i2.TranslateService }]; }, propDecorators: { startRowTitles: [{
                type: Input
            }], month: [{
                type: Input
            }], year: [{
                type: Input
            }], updated: [{
                type: Output
            }], data: [{
                type: Input
            }], hideHeader: [{
                type: Input
            }], timeShift: [{
                type: Input
            }], lessionUnit: [{
                type: Input
            }], userType: [{
                type: Input
            }], onChangeOnOffSwitch: [{
                type: Output
            }], scheduleOpened: [{
                type: Output
            }], isBOSide: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvY2FsZW5kYXIvc3JjL2xpYi9jYWxlbmRhci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9jYWxlbmRhci9zcmMvbGliL2NhbGVuZGFyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxTQUFTLEVBRVQsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBRVAsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxLQUFLLENBQUMsTUFBTSxRQUFRLENBQUM7QUFDNUIsT0FBTyxFQUNMLDJCQUEyQixFQUMzQixhQUFhLEdBQ2QsTUFBTSxhQUFhLENBQUM7Ozs7Ozs7QUFZckIsTUFBTSxPQUFPLGlCQUFpQjtJQTBCNUIsWUFDVSxxQkFBNEMsRUFDNUMsU0FBMkI7UUFEM0IsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUF1QjtRQUM1QyxjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQTFCckMsb0JBQWUsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFFOUIsbUJBQWMsR0FBYSxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDakQsVUFBSyxHQUFXLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUM3RCxTQUFJLEdBQVcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3pELFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzlCLFNBQUksR0FBUSxJQUFJLENBQUM7UUFDakIsZUFBVSxHQUFRLElBQUksQ0FBQztRQUN2QixjQUFTLEdBQVEsSUFBSSxDQUFDO1FBR3JCLHdCQUFtQixHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDOUMsbUJBQWMsR0FBRyxJQUFJLFlBQVks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QUFDLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUN0RCxDQUFDO1lBQ0YsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsR0FBRztnQkFDeEIsS0FBSyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDeEMsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGdCQUFnQixDQUFDLEdBQVcsRUFBRSxLQUFhO1FBQ3pDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FDakQsQ0FBQyxJQUFTLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxJQUFJLElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzNFLE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQzs7OEdBM0tVLGlCQUFpQjtrR0FBakIsaUJBQWlCLGlaQzFCOUIsbW1GQW9FRTsyRkQxQ1csaUJBQWlCO2tCQVA3QixTQUFTOytCQUNFLG1CQUFtQjsySUFVcEIsY0FBYztzQkFBdEIsS0FBSztnQkFDRyxLQUFLO3NCQUFiLEtBQUs7Z0JBQ0csSUFBSTtzQkFBWixLQUFLO2dCQUNJLE9BQU87c0JBQWhCLE1BQU07Z0JBQ0UsSUFBSTtzQkFBWixLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0ksbUJBQW1CO3NCQUE1QixNQUFNO2dCQUNHLGNBQWM7c0JBQXZCLE1BQU07Z0JBQ0UsUUFBUTtzQkFBaEIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIERvQ2hlY2ssXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHtcbiAgVElNRVRBQkxFX0NIQU5HRV9ESVJFQ1RJT05TLFxuICB3ZWVrRGF5TGFiZWxzLFxufSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBDYWxlbmRhclR5cGUgfSBmcm9tICcuL3R5cGluZ3MnO1xuaW1wb3J0IHsgVGFkYU5neENhbGVuZGFySGVscGVyIH0gZnJvbSAnLi9jYWxlbmRhci5oZWxwZXInO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0YWRhLW5neC1jYWxlbmRhcicsXG4gIHRlbXBsYXRlVXJsOiBgY2FsZW5kYXIuY29tcG9uZW50Lmh0bWxgLFxuICBzdHlsZVVybHM6IFtcbiAgICAnY2FsZW5kYXIuY29tcG9uZW50LnNjc3MnXG4gIF1cbn0pXG5leHBvcnQgY2xhc3MgQ2FsZW5kYXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIERvQ2hlY2sge1xuXG4gIGxlc3Npb25OdW1PZkRheSA9IFsuLi5BcnJheSg1KS5rZXlzKCldO1xuXG4gIEBJbnB1dCgpIHN0YXJ0Um93VGl0bGVzOiBzdHJpbmdbXSA9IHRoaXMuYnVpbGRSb3dUaXRsZXMoKTtcbiAgQElucHV0KCkgbW9udGg6IG51bWJlciA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmdldEN1cnJlbnRNb250aCgpO1xuICBASW5wdXQoKSB5ZWFyOiBudW1iZXIgPSB0aGlzLnRhZGFOZ3hDYWxlbmRhckhlbHBlci5nZXRBY3RpdmVZZWFyKCk7XG4gIEBPdXRwdXQoKSB1cGRhdGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBASW5wdXQoKSBkYXRhOiBhbnkgPSBudWxsO1xuICBASW5wdXQoKSBoaWRlSGVhZGVyOiBhbnkgPSBudWxsO1xuICBASW5wdXQoKSB0aW1lU2hpZnQ6IGFueSA9IG51bGw7XG4gIEBJbnB1dCgpIGxlc3Npb25Vbml0OiBhbnk7XG4gIEBJbnB1dCgpIHVzZXJUeXBlOiBhbnk7XG4gIEBPdXRwdXQoKSBvbkNoYW5nZU9uT2ZmU3dpdGNoID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBzY2hlZHVsZU9wZW5lZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBASW5wdXQoKSBpc0JPU2lkZTogYW55O1xuICBkYXluYW1lc09mV2VlayA9IFsuLi53ZWVrRGF5TGFiZWxzXTtcbiAgdGltZVRhYmxlRGF0YTogYW55ID0ge307XG4gIG9iamVjdEtleXMgPSBPYmplY3Qua2V5cztcbiAgd2Vla2RheXM6IGFueVtdID0gW107XG4gIHNjaGVkdWxlczogYW55ID0ge307XG4gIHRpbWVUYWJsZVVJRGF0YTogQ2FsZW5kYXJUeXBlID0ge307XG4gIGFjdGl2ZVdlZWs6IG51bWJlciA9IDA7XG4gIHRvdGFsV2Vla09mWWVhciA9IDA7XG4gIHN0YXJ0RGF5T2ZXZWVrOiBhbnkgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgdGFkYU5neENhbGVuZGFySGVscGVyOiBUYWRhTmd4Q2FsZW5kYXJIZWxwZXIsXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2VcbiAgKSB7XG4gICAgdGhpcy50cmFuc2xhdGUuc2V0RGVmYXVsdExhbmcoJ3ZuJyk7XG4gICAgdGhpcy5idWlsZFJvd1RpdGxlcygpO1xuICB9XG5cbiAgbmdEb0NoZWNrKCk6IHZvaWQgeyB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuXG4gICAgY29uc29sZS5sb2coe2NoYW5nZXN9KVxuXG4gICAgaWYgKGNoYW5nZXNbJ2RhdGEnXT8uY3VycmVudFZhbHVlICYmIGNoYW5nZXNbJ2RhdGEnXT8uY3VycmVudFZhbHVlLmxlbmd0aCkge1xuICAgICAgdGhpcy5vbkNoYW5nZVNjaGVkdWxlcygpO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGNoYW5nZXNbJ21vbnRoJ10/LmZpcnN0Q2hhbmdlICYmXG4gICAgICBjaGFuZ2VzWydtb250aCddLmN1cnJlbnRWYWx1ZSAmJlxuICAgICAgY2hhbmdlc1sneWVhciddPy5maXJzdENoYW5nZSAmJlxuICAgICAgY2hhbmdlc1sneWVhciddLmN1cnJlbnRWYWx1ZVxuICAgICkge1xuICAgICAgdGhpcy5hY3RpdmVXZWVrID0gdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuY3VycmVudFdlZWtOdW1iZXIoKTtcbiAgICAgIHRoaXMudG90YWxXZWVrT2ZZZWFyID0gdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuaXNvV2Vla3NJblllYXIodGhpcy55ZWFyKTtcbiAgICAgIHRoaXMub25DaGFuZ2VEaXJlY3Rpb24oVElNRVRBQkxFX0NIQU5HRV9ESVJFQ1RJT05TLk1PVkVfVE9EQVkpO1xuICAgIH0gZWxzZSBpZiAoY2hhbmdlc1snbW9udGgnXT8uY3VycmVudFZhbHVlIHx8IGNoYW5nZXNbJ3llYXInXT8uY3VycmVudFZhbHVlKSB7XG4gICAgICB0aGlzLmNoYW5nZU1vbnRoWWVhcigpO1xuICAgIH1cblxuICB9XG5cbiAgYnVpbGRSb3dUaXRsZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMubGVzc2lvbk51bU9mRGF5Lm1hcChcbiAgICAgIChfLCBpbmRleDogbnVtYmVyKSA9PiBgVGnhur90ICR7aW5kZXggKyAxfWBcbiAgICApO1xuICB9XG5cbiAgb25DaGFuZ2VEaXJlY3Rpb24oYWN0aW9uOiBzdHJpbmcpIHtcbiAgICBzd2l0Y2ggKGFjdGlvbikge1xuICAgICAgY2FzZSBUSU1FVEFCTEVfQ0hBTkdFX0RJUkVDVElPTlMuTU9WRV9QUkVWOlxuICAgICAgICB0aGlzLmdvUHJldmlvdXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFRJTUVUQUJMRV9DSEFOR0VfRElSRUNUSU9OUy5NT1ZFX05FWFQ6XG4gICAgICAgIHRoaXMuZ29OZXh0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBUSU1FVEFCTEVfQ0hBTkdFX0RJUkVDVElPTlMuTU9WRV9UT0RBWTpcbiAgICAgICAgdGhpcy50b2RheSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmhhbmRsZURhdGV0aW1lKHRoaXMuc3RhcnREYXlPZldlZWspO1xuICB9XG5cbiAgY2FuR29QcmV2aW91cygpIHtcbiAgICByZXR1cm4gdGhpcy5hY3RpdmVXZWVrIDwgdGhpcy50b3RhbFdlZWtPZlllYXI7XG4gIH1cblxuICBjYW5Hb05leHQoKSB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZlV2VlayA8IHRoaXMudG90YWxXZWVrT2ZZZWFyO1xuICB9XG5cbiAgZ29QcmV2aW91cygpIHtcbiAgICB0aGlzLnN0YXJ0RGF5T2ZXZWVrID0gdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuc3VidHJhY3QoXG4gICAgICB0aGlzLnN0YXJ0RGF5T2ZXZWVrXG4gICAgKTtcbiAgfVxuXG4gIGdvTmV4dCgpIHtcbiAgICB0aGlzLnN0YXJ0RGF5T2ZXZWVrID0gdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuYWRkKHRoaXMuc3RhcnREYXlPZldlZWspO1xuICB9XG5cbiAgdG9kYXkoKSB7XG4gICAgY29uc3QgY3VycmVudFdlZWsgPSB0aGlzLnRhZGFOZ3hDYWxlbmRhckhlbHBlci5jdXJyZW50V2Vla051bWJlcigpO1xuICAgIHRoaXMuc3RhcnREYXlPZldlZWsgPSB0aGlzLnRhZGFOZ3hDYWxlbmRhckhlbHBlci5kYXlTdGFydE9mV2VlayhcbiAgICAgIGN1cnJlbnRXZWVrLFxuICAgICAgdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuZ2V0Q3VycmVudFllYXIoKVxuICAgICk7XG4gIH1cblxuICBoYW5kbGVEYXRldGltZShmcm9tRGF0ZTogc3RyaW5nKSB7XG4gICAgdGhpcy53ZWVrZGF5cyA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmdldFdlZWtEYXlzQnlEYXkoZnJvbURhdGUpO1xuICAgIHRoaXMuYWN0aXZlV2VlayA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmdldFdlZWtOdW1iZXJCeURhdGUoXG4gICAgICB0aGlzLndlZWtkYXlzWzBdXG4gICAgKTtcbiAgICBjb25zdCBbeWVhciwgbW9udGhdID0gZnJvbURhdGUuc3BsaXQoJy0nKTtcblxuICAgIHRoaXMubW9udGggPSArbW9udGg7XG4gICAgdGhpcy55ZWFyID0gK3llYXI7XG5cbiAgICB0aGlzLnN0YXJ0RGF5T2ZXZWVrID0gdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuZGF5U3RhcnRPZldlZWsoXG4gICAgICB0aGlzLmFjdGl2ZVdlZWssXG4gICAgICB0aGlzLnllYXJcbiAgICApO1xuICAgIHRoaXMudGltZVRhYmxlVUlEYXRhID0ge1xuICAgICAgc3RhcnREYXRlOiB0aGlzLnRhZGFOZ3hDYWxlbmRhckhlbHBlci5nZXRUaW1lUmFuZ2UodGhpcy53ZWVrZGF5c1swXSlcbiAgICAgICAgLnRpbWVTdGFtcFV0Yy5zdGFydE9mRGF5LFxuICAgICAgZW5kRGF0ZTogdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuZ2V0VGltZVJhbmdlKFxuICAgICAgICB0aGlzLndlZWtkYXlzW3RoaXMud2Vla2RheXMubGVuZ3RoIC0gMV1cbiAgICAgICkudGltZVN0YW1wVXRjLmVuZE9mRGF5LFxuICAgICAgd2Vla051bWJlcjogdGhpcy5hY3RpdmVXZWVrLFxuICAgIH07XG5cbiAgICB0aGlzLnVwZGF0ZWQuZW1pdCh0aGlzLnRpbWVUYWJsZVVJRGF0YSk7XG4gICAgdGhpcy5yZW5kZXJEYXlPZldlZWsoKTtcbiAgfVxuXG4gIGNoYW5nZU1vbnRoWWVhcigpIHtcbiAgICBjb25zdCBuZXdEYXRlID0gYCR7dGhpcy55ZWFyfS0ke3RoaXMubW9udGh9LTAxYDtcbiAgICB0aGlzLmhhbmRsZURhdGV0aW1lKG5ld0RhdGUpO1xuICB9XG5cbiAgZ2VuZXJhdGVCYXNpY0RhdGUoKSB7XG4gICAgdGhpcy5kYXluYW1lc09mV2Vlay5mb3JFYWNoKChkYXk6IHN0cmluZykgPT4ge1xuICAgICAgdGhpcy50aW1lVGFibGVEYXRhW2RheV0gPSB7XG4gICAgICAgIGl0ZW1zOiBbXSxcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICByZW5kZXJEYXlPZldlZWsoKSB7XG4gICAgdGhpcy5zY2hlZHVsZXMgPSB0aGlzLndlZWtkYXlzLnJlZHVjZShcbiAgICAgIChwcmV2OiBhbnksIGN1cnJlbnQ6IGFueSkgPT4gKHsgLi4ucHJldiwgW2N1cnJlbnRdOiBjdXJyZW50IH0pLFxuICAgICAge31cbiAgICApO1xuICB9XG5cbiAgb25DaGFuZ2VTY2hlZHVsZXMoKSB7XG4gICAgdGhpcy53ZWVrZGF5cy5mb3JFYWNoKChkYXkpID0+IHtcbiAgICAgIGNvbnN0IHNsb3RzT2ZEYXkgPSB0aGlzLmRhdGEuZmlsdGVyKChzbG90OiBhbnkpID0+XG4gICAgICAgIHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmluRGF5KHNsb3Quc3RhcnRUaW1lLCBkYXkpXG4gICAgICApO1xuICAgICAgdGhpcy50aW1lVGFibGVEYXRhW2RheV0gPSB7XG4gICAgICAgIGl0ZW1zOiBfLm9yZGVyQnkoc2xvdHNPZkRheSwgWydvcmRlciddKSxcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBnZXRMZXNzb25CeU9yZGVyKGRheTogc3RyaW5nLCBpbmRleDogbnVtYmVyKSB7XG4gICAgY29uc3QgZm91bmQgPSB0aGlzLnRpbWVUYWJsZURhdGFbZGF5XT8uaXRlbXMuZmlsdGVyKFxuICAgICAgKGl0ZW06IGFueSkgPT4gaXRlbS5vcmRlciA9PT0gaW5kZXggJiYgaXRlbS50aW1lU2hpZnQgPT0gdGhpcy50aW1lU2hpZnQpO1xuICAgIHJldHVybiBmb3VuZDtcbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cImhlYWRlci10aW1ldGFibGUtd29ya2luZ1wiICpuZ0lmPVwiIWhpZGVIZWFkZXJcIj5cbiAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1iZXR3ZWVuXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0aW1ldGFibGV1aS1hY3RpdmUtd2Vla251bVwiPlxuICAgICAgICAgIFR14bqnbiB7eyB0aW1lVGFibGVVSURhdGE/LndlZWtOdW1iZXIgfX0gdGjDoW5nIHt7bW9udGh9fSBuxINtIHt7IHN0YXJ0RGF5T2ZXZWVrIHwgZGF0ZTogJ3l5eXknIH19XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDx0YWRhLW5neC1jYWxlbmRhci1uYXZpZ2F0aW9uXG4gICAgICAgICAgICAobmF2aUNoYW5nZSk9XCJvbkNoYW5nZURpcmVjdGlvbigkZXZlbnQpXCJcbiAgICAgICAgICA+PC90YWRhLW5neC1jYWxlbmRhci1uYXZpZ2F0aW9uPlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIFxuICA8aDQgY2xhc3M9XCJ0aW1lc2hpZnRfdGl0bGVcIj57eyB0aW1lU2hpZnQgfCB0cmFuc2xhdGUgfX08L2g0PlxuICBcbiAgPGRpdiBjbGFzcz1cInRhZGEtbmd4LWNhbGVuZGFyXCI+XG4gICAgPGRpdiBjbGFzcz1cInRhZGEtbmd4LWNhbGVuZGFyLXdyYXAtc2Nyb2xsXCI+XG4gICAgICA8ZGl2IGlkPVwidGFkYS1uZ3gtY2FsZW5kYXItY2FsZW5kYXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInRhZGEtbmd4LWNhbGVuZGFyLXByZWZpeC1jb2x1bW4gdGFkYS1uZ3gtY2FsZW5kYXItZGF5LWNvbHVtblwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0YWRhLW5neC1jYWxlbmRhci1kYXktY29sdW1uLWxlc3Npb25cIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0YWRhLW5neC1jYWxlbmRhci1kYXktbmFtZVwiICpuZ0lmPVwiIWhpZGVIZWFkZXJcIj5cbiAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICA8c3Bhbj48L3NwYW4+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItZGF5LWxlc3Npb24taXRlbSBwcmUtbGFiZWwtY29sdW1uLXZhbHVlXCJcbiAgICAgICAgICAgICAgKm5nRm9yPVwibGV0IHRpdGxlIG9mIHN0YXJ0Um93VGl0bGVzXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICA8c3Bhbj57eyB0aXRsZSB9fTwvc3Bhbj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICAqbmdGb3I9XCJsZXQgZGF5IG9mIG9iamVjdEtleXMoc2NoZWR1bGVzKTsgaW5kZXggYXMgaVwiXG4gICAgICAgICAgY2xhc3M9XCJ0YWRhLW5neC1jYWxlbmRhci1kYXktY29sdW1uXCJcbiAgICAgICAgPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0YWRhLW5neC1jYWxlbmRhci1kYXktY29sdW1uLWxlc3Npb25cIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0YWRhLW5neC1jYWxlbmRhci1kYXktbmFtZVwiICpuZ0lmPVwiIWhpZGVIZWFkZXJcIj5cbiAgICAgICAgICAgICAgPHA+e3sgZGF5bmFtZXNPZldlZWtbaV0gfCB0cmFuc2xhdGUgfX08L3A+XG4gICAgICAgICAgICAgIDxoND57eyBkYXkgfCBkYXRlOiAnZCcgfX08L2g0PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItZGF5LWxlc3Npb24taXRlbVwiXG4gICAgICAgICAgICAgICpuZ0Zvcj1cImxldCBsZXNzb25OdW0gb2YgbGVzc2lvbk51bU9mRGF5XCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRpbWV0YWJsZS1jZWxsLWJsb2NrXCI+XG4gICAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICAgKm5nRm9yPVwibGV0IGxlc3Npb24gb2YgZ2V0TGVzc29uQnlPcmRlcihkYXksIGxlc3Nvbk51bSsxKVwiXG4gICAgICAgICAgICAgICAgICBjbGFzcz1cInRhZGEtbmd4LWNhbGVuZGFyLWRheS1zY2hlZHVsZS1pdGVtX19pdGVtXCJcbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICA8dGltZXRhYmxlLWNlbGxcbiAgICAgICAgICAgICAgICAgIFt1c2VyVHlwZV09XCJ1c2VyVHlwZVwiXG4gICAgICAgICAgICAgICAgICBbaXNCT1NpZGVdPVwiaXNCT1NpZGVcIlxuICAgICAgICAgICAgICAgICAgW2xlc3Npb25Vbml0XT1cImxlc3Npb25Vbml0XCJcbiAgICAgICAgICAgICAgICAgIChzY2hlZHVsZU9wZW5lZCk9XCJzY2hlZHVsZU9wZW5lZC5lbWl0KCRldmVudClcIlxuICAgICAgICAgICAgICAgICAgKG9uQ2hhbmdlT25PZmZTd2l0Y2gpPVwib25DaGFuZ2VPbk9mZlN3aXRjaC5lbWl0KCRldmVudClcIlxuICAgICAgICAgICAgICAgICAgW3NjaGVkdWxlXT1cImxlc3Npb25cIj48L3RpbWV0YWJsZS1jZWxsPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbiAgIl19