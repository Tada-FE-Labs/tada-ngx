import { Component, EventEmitter, Input, Output } from '@angular/core';
import * as _ from 'lodash';
import { TIMETABLE_CHANGE_DIRECTIONS, weekDayLabels, } from './constants';
import * as i0 from "@angular/core";
import * as i1 from "./calendar.helper";
import * as i2 from "@ngx-translate/core";
import * as i3 from "@angular/common";
import * as i4 from "./components/timetable-cell/timetable-cell.component";
import * as i5 from "./components/calendar-navi/calendar-navi.component";
export class CalendarComponent {
    constructor(tadaNgxCalendarHelper, translate) {
        this.tadaNgxCalendarHelper = tadaNgxCalendarHelper;
        this.translate = translate;
        this.lessionNumOfDay = [...Array(5).keys()];
        this.startRowTitles = this.buildRowTitles();
        this.month = this.tadaNgxCalendarHelper.getCurrentMonth();
        this.year = this.tadaNgxCalendarHelper.getActiveYear();
        this.updated = new EventEmitter();
        this.data = null;
        this.timeShifts = [];
        this.onChangeOnOffSwitch = new EventEmitter();
        this.scheduleOpened = new EventEmitter();
        this.daynamesOfWeek = [...weekDayLabels];
        this.timeTableData = {};
        this.objectKeys = Object.keys;
        this.weekdays = [];
        this.schedules = {};
        this.timeTableUIData = {};
        this.activeWeek = 0;
        this.totalWeekOfYear = 0;
        this.startDayOfWeek = null;
        this.assignments = [];
        this.translate.setDefaultLang('vn');
        this.buildRowTitles();
    }
    ngDoCheck() { }
    ngOnChanges(changes) {
        if (changes['data']?.currentValue && changes['data']?.currentValue.length) {
            this.onChangeSchedules();
        }
        if (changes['month']?.firstChange &&
            changes['month'].currentValue &&
            changes['year']?.firstChange &&
            changes['year'].currentValue) {
            this.activeWeek = this.tadaNgxCalendarHelper.currentWeekNumber();
            this.totalWeekOfYear = this.tadaNgxCalendarHelper.isoWeeksInYear(this.year);
            this.onChangeDirection(TIMETABLE_CHANGE_DIRECTIONS.MOVE_TODAY);
        }
        else if (changes['month']?.currentValue || changes['year']?.currentValue) {
            this.changeMonthYear();
        }
    }
    buildRowTitles() {
        return this.lessionNumOfDay.map((_, index) => `Tiết ${index + 1}`);
    }
    onChangeDirection(action) {
        switch (action) {
            case TIMETABLE_CHANGE_DIRECTIONS.MOVE_PREV:
                this.goPrevious();
                break;
            case TIMETABLE_CHANGE_DIRECTIONS.MOVE_NEXT:
                this.goNext();
                break;
            case TIMETABLE_CHANGE_DIRECTIONS.MOVE_TODAY:
                this.today();
                break;
            default:
                return;
        }
        this.handleDatetime(this.startDayOfWeek);
    }
    canGoPrevious() {
        return this.activeWeek < this.totalWeekOfYear;
    }
    canGoNext() {
        return this.activeWeek < this.totalWeekOfYear;
    }
    goPrevious() {
        this.startDayOfWeek = this.tadaNgxCalendarHelper.subtract(this.startDayOfWeek);
    }
    goNext() {
        this.startDayOfWeek = this.tadaNgxCalendarHelper.add(this.startDayOfWeek);
    }
    today() {
        const currentWeek = this.tadaNgxCalendarHelper.currentWeekNumber();
        this.startDayOfWeek = this.tadaNgxCalendarHelper.dayStartOfWeek(currentWeek, this.tadaNgxCalendarHelper.getCurrentYear());
    }
    handleDatetime(fromDate) {
        this.weekdays = this.tadaNgxCalendarHelper.getWeekDaysByDay(fromDate);
        this.activeWeek = this.tadaNgxCalendarHelper.getWeekNumberByDate(this.weekdays[0]);
        const [year, month] = fromDate.split('-');
        this.month = +month;
        this.year = +year;
        this.startDayOfWeek = this.tadaNgxCalendarHelper.dayStartOfWeek(this.activeWeek, this.year);
        this.timeTableUIData = {
            startDate: this.tadaNgxCalendarHelper.getTimeRange(this.weekdays[0])
                .timeStampUtc.startOfDay,
            endDate: this.tadaNgxCalendarHelper.getTimeRange(this.weekdays[this.weekdays.length - 1]).timeStampUtc.endOfDay,
            weekNumber: this.activeWeek,
        };
        this.updated.emit(this.timeTableUIData);
        this.renderDayOfWeek();
    }
    changeMonthYear() {
        const newDate = `${this.year}-${this.month}-01`;
        this.handleDatetime(newDate);
    }
    generateBasicDate() {
        this.daynamesOfWeek.forEach((day) => {
            this.timeTableData[day] = {
                items: [],
            };
        });
    }
    renderDayOfWeek() {
        this.schedules = this.weekdays.reduce((prev, current) => ({ ...prev, [current]: current }), {});
    }
    onChangeSchedules() {
        this.weekdays.forEach((day) => {
            const slotsOfDay = this.data.filter((slot) => this.tadaNgxCalendarHelper.inDay(slot.startTime, day));
            this.timeTableData[day] = {
                items: _.orderBy(slotsOfDay, ['order']),
            };
        });
    }
    getLessonByOrder(day, index, timeShift) {
        const found = this.timeTableData[day]?.items.find((item) => item.order === index && item.timeShift == timeShift);
        return found;
    }
}
CalendarComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: CalendarComponent, deps: [{ token: i1.TadaNgxCalendarHelper }, { token: i2.TranslateService }], target: i0.ɵɵFactoryTarget.Component });
CalendarComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: CalendarComponent, selector: "tada-ngx-calendar", inputs: { startRowTitles: "startRowTitles", month: "month", year: "year", data: "data", timeShifts: "timeShifts", lessionUnit: "lessionUnit", userType: "userType", isBOSide: "isBOSide", assignments: "assignments" }, outputs: { updated: "updated", onChangeOnOffSwitch: "onChangeOnOffSwitch", scheduleOpened: "scheduleOpened" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"header-timetable-working\">\n    <div class=\"d-flex justify-content-between\">\n        <div class=\"timetableui-active-weeknum\">\n          Tu\u1EA7n {{ timeTableUIData?.weekNumber }} th\u00E1ng {{month}} n\u0103m {{ startDayOfWeek | date: 'yyyy' }}\n        </div>\n        <div>\n          <tada-ngx-calendar-navigation\n            (naviChange)=\"onChangeDirection($event)\"\n          ></tada-ngx-calendar-navigation>\n        </div>\n    </div>\n  </div>\n  \n  <div *ngFor=\"let timeShift of timeShifts; index as timeShiftIndex\">\n\n  <h4 class=\"timeshift_title\">{{ timeShift | translate }}</h4>\n  \n  <div class=\"tada-ngx-calendar mb-3\">\n    <div class=\"tada-ngx-calendar-wrap-scroll\">\n      <div id=\"tada-ngx-calendar-calendar\">\n        <div class=\"tada-ngx-calendar-prefix-column tada-ngx-calendar-day-column\">\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"timeShiftIndex == 0\">\n              <div>\n                <span></span>\n              </div>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item pre-label-column-value\"\n              *ngFor=\"let title of startRowTitles\"\n            >\n              <div>\n                <span>{{ title }}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div\n          *ngFor=\"let day of objectKeys(schedules); index as i\"\n          class=\"tada-ngx-calendar-day-column\"\n        >\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"timeShiftIndex == 0\">\n              <p>{{ daynamesOfWeek[i] | translate }}</p>\n              <h4>{{ day | date: 'd' }}</h4>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item\"\n              *ngFor=\"let lessonNum of lessionNumOfDay\"\n            >\n              <div class=\"timetable-cell-block\">\n                <div\n                  *ngIf=\"getLessonByOrder(day, lessonNum+1, timeShift) as lession\"\n                  class=\"tada-ngx-calendar-day-schedule-item__item\"\n                >\n                  <timetable-cell\n                  [userType]=\"userType\"\n                  [isBOSide]=\"isBOSide\"\n                  [lessionUnit]=\"lessionUnit\"\n                  [assignments]=\"assignments\"\n                  (scheduleOpened)=\"scheduleOpened.emit($event)\"\n                  (onChangeOnOffSwitch)=\"onChangeOnOffSwitch.emit($event)\"\n                  [schedule]=\"lession\"></timetable-cell>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  </div>", styles: [".tada-ngx-calendar-prefix-column{width:100px!important}.tada-ngx-calendar-prefix-column span{display:block;width:100px!important}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-name{height:91px}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item span{font-weight:600;font-size:12px;line-height:12px;text-align:center;color:#b4b7c6}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item:first-child:not(.pre-label-column-value)>div{border-top:none;height:87px}.tada-ngx-calendar-wrap-scroll{overflow:auto;display:flex}#tada-ngx-calendar-calendar{display:flex;flex-direction:row;flex:1;justify-content:space-between;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name{text-align:center;padding:16px 8px;width:100%;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name p{font-weight:600;font-size:12px;line-height:12px;color:#b4b7c6}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name h4{font-style:normal;font-weight:600;font-size:24px;line-height:29px;margin:0;color:#000}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column{width:100%}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession{display:flex;flex-direction:column}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div{padding:5px 10px;font-weight:600;font-size:14px;display:block;line-height:20px;width:100%;text-align:center;color:#000;border:1px solid #e2e8f0;align-items:center;justify-content:center;display:flex;height:60px;flex-direction:column;gap:5px}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item h4{width:100%;overflow:hidden;text-overflow:ellipsis;margin:0;font-size:.85rem}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item .timetable_tutor_name{font-weight:400;font-size:14px;line-height:20px;text-align:center;font-style:normal;color:#737579}.timetable-cell-block{min-width:160px}.tada-ngx-calendar-day-schedule-item__item{display:block;width:100%}.tada-ngx-calendar-direction-controls{display:flex;flex-direction:row;font-weight:700;font-size:16px;line-height:18px;text-align:center;color:#000;gap:35px;align-items:center;margin-bottom:10px}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control{cursor:pointer}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control:not(.can_navigate_to){cursor:not-allowed;opacity:.57}.tada-ngx-calendar-direction-controls .active_class_name{font-weight:700;font-size:16px;white-space:nowrap;max-width:300px;overflow:hidden;text-overflow:ellipsis;line-height:18px;text-align:center;color:#000}timetable-cell{display:block;width:100%}h4.timeshift_title{font-style:normal;font-weight:400;font-size:14px;line-height:18px;color:#000;margin-bottom:5px}\n"], dependencies: [{ kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.TadaNgxCalendarCellComponent, selector: "timetable-cell", inputs: ["schedule", "lessionUnit", "assignments", "userType", "isBOSide"], outputs: ["onChangeOnOffSwitch", "scheduleOpened"] }, { kind: "component", type: i5.TadaNgxCalendarUICalendarNaviComponent, selector: "tada-ngx-calendar-navigation", inputs: ["viewName"], outputs: ["naviChange"] }, { kind: "pipe", type: i3.DatePipe, name: "date" }, { kind: "pipe", type: i2.TranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: CalendarComponent, decorators: [{
            type: Component,
            args: [{ selector: 'tada-ngx-calendar', template: "<div class=\"header-timetable-working\">\n    <div class=\"d-flex justify-content-between\">\n        <div class=\"timetableui-active-weeknum\">\n          Tu\u1EA7n {{ timeTableUIData?.weekNumber }} th\u00E1ng {{month}} n\u0103m {{ startDayOfWeek | date: 'yyyy' }}\n        </div>\n        <div>\n          <tada-ngx-calendar-navigation\n            (naviChange)=\"onChangeDirection($event)\"\n          ></tada-ngx-calendar-navigation>\n        </div>\n    </div>\n  </div>\n  \n  <div *ngFor=\"let timeShift of timeShifts; index as timeShiftIndex\">\n\n  <h4 class=\"timeshift_title\">{{ timeShift | translate }}</h4>\n  \n  <div class=\"tada-ngx-calendar mb-3\">\n    <div class=\"tada-ngx-calendar-wrap-scroll\">\n      <div id=\"tada-ngx-calendar-calendar\">\n        <div class=\"tada-ngx-calendar-prefix-column tada-ngx-calendar-day-column\">\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"timeShiftIndex == 0\">\n              <div>\n                <span></span>\n              </div>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item pre-label-column-value\"\n              *ngFor=\"let title of startRowTitles\"\n            >\n              <div>\n                <span>{{ title }}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div\n          *ngFor=\"let day of objectKeys(schedules); index as i\"\n          class=\"tada-ngx-calendar-day-column\"\n        >\n          <div class=\"tada-ngx-calendar-day-column-lession\">\n            <div class=\"tada-ngx-calendar-day-name\" *ngIf=\"timeShiftIndex == 0\">\n              <p>{{ daynamesOfWeek[i] | translate }}</p>\n              <h4>{{ day | date: 'd' }}</h4>\n            </div>\n            <div\n              class=\"tada-ngx-calendar-day-lession-item\"\n              *ngFor=\"let lessonNum of lessionNumOfDay\"\n            >\n              <div class=\"timetable-cell-block\">\n                <div\n                  *ngIf=\"getLessonByOrder(day, lessonNum+1, timeShift) as lession\"\n                  class=\"tada-ngx-calendar-day-schedule-item__item\"\n                >\n                  <timetable-cell\n                  [userType]=\"userType\"\n                  [isBOSide]=\"isBOSide\"\n                  [lessionUnit]=\"lessionUnit\"\n                  [assignments]=\"assignments\"\n                  (scheduleOpened)=\"scheduleOpened.emit($event)\"\n                  (onChangeOnOffSwitch)=\"onChangeOnOffSwitch.emit($event)\"\n                  [schedule]=\"lession\"></timetable-cell>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  </div>", styles: [".tada-ngx-calendar-prefix-column{width:100px!important}.tada-ngx-calendar-prefix-column span{display:block;width:100px!important}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-name{height:91px}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item span{font-weight:600;font-size:12px;line-height:12px;text-align:center;color:#b4b7c6}.tada-ngx-calendar-prefix-column .tada-ngx-calendar-day-lession-item:first-child:not(.pre-label-column-value)>div{border-top:none;height:87px}.tada-ngx-calendar-wrap-scroll{overflow:auto;display:flex}#tada-ngx-calendar-calendar{display:flex;flex-direction:row;flex:1;justify-content:space-between;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name{text-align:center;padding:16px 8px;width:100%;border:1px solid #e2e8f0}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name p{font-weight:600;font-size:12px;line-height:12px;color:#b4b7c6}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-name h4{font-style:normal;font-weight:600;font-size:24px;line-height:29px;margin:0;color:#000}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column{width:100%}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession{display:flex;flex-direction:column}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div{padding:5px 10px;font-weight:600;font-size:14px;display:block;line-height:20px;width:100%;text-align:center;color:#000;border:1px solid #e2e8f0;align-items:center;justify-content:center;display:flex;height:60px;flex-direction:column;gap:5px}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item h4{width:100%;overflow:hidden;text-overflow:ellipsis;margin:0;font-size:.85rem}#tada-ngx-calendar-calendar .tada-ngx-calendar-day-column-lession>.tada-ngx-calendar-day-lession-item>div div.tada-ngx-calendar-day-lession-item__item .timetable_tutor_name{font-weight:400;font-size:14px;line-height:20px;text-align:center;font-style:normal;color:#737579}.timetable-cell-block{min-width:160px}.tada-ngx-calendar-day-schedule-item__item{display:block;width:100%}.tada-ngx-calendar-direction-controls{display:flex;flex-direction:row;font-weight:700;font-size:16px;line-height:18px;text-align:center;color:#000;gap:35px;align-items:center;margin-bottom:10px}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control{cursor:pointer}.tada-ngx-calendar-direction-controls .tada-ngx-calendar-direction-control:not(.can_navigate_to){cursor:not-allowed;opacity:.57}.tada-ngx-calendar-direction-controls .active_class_name{font-weight:700;font-size:16px;white-space:nowrap;max-width:300px;overflow:hidden;text-overflow:ellipsis;line-height:18px;text-align:center;color:#000}timetable-cell{display:block;width:100%}h4.timeshift_title{font-style:normal;font-weight:400;font-size:14px;line-height:18px;color:#000;margin-bottom:5px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.TadaNgxCalendarHelper }, { type: i2.TranslateService }]; }, propDecorators: { startRowTitles: [{
                type: Input
            }], month: [{
                type: Input
            }], year: [{
                type: Input
            }], updated: [{
                type: Output
            }], data: [{
                type: Input
            }], timeShifts: [{
                type: Input
            }], lessionUnit: [{
                type: Input
            }], userType: [{
                type: Input
            }], onChangeOnOffSwitch: [{
                type: Output
            }], scheduleOpened: [{
                type: Output
            }], isBOSide: [{
                type: Input
            }], assignments: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvY2FsZW5kYXIvc3JjL2xpYi9jYWxlbmRhci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9jYWxlbmRhci9zcmMvbGliL2NhbGVuZGFyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxTQUFTLEVBRVQsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBRVAsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxLQUFLLENBQUMsTUFBTSxRQUFRLENBQUM7QUFDNUIsT0FBTyxFQUNMLDJCQUEyQixFQUMzQixhQUFhLEdBQ2QsTUFBTSxhQUFhLENBQUM7Ozs7Ozs7QUFZckIsTUFBTSxPQUFPLGlCQUFpQjtJQTBCNUIsWUFDVSxxQkFBNEMsRUFDNUMsU0FBMkI7UUFEM0IsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUF1QjtRQUM1QyxjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQTFCckMsb0JBQWUsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFFOUIsbUJBQWMsR0FBYSxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDakQsVUFBSyxHQUFXLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUM3RCxTQUFJLEdBQVcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3pELFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzlCLFNBQUksR0FBUSxJQUFJLENBQUM7UUFDakIsZUFBVSxHQUFVLEVBQUUsQ0FBQztRQUd0Qix3QkFBbUIsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQzlDLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUVuRCxtQkFBYyxHQUFH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LENBQUMsQ0FDdEQsQ0FBQztZQUNGLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEdBQUc7Z0JBQ3hCLEtBQUssRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQ3hDLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxnQkFBZ0IsQ0FBQyxHQUFXLEVBQUUsS0FBYSxFQUFFLFNBQWlCO1FBQzVELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FDL0MsQ0FBQyxJQUFTLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxJQUFJLElBQUksQ0FBQyxTQUFTLElBQUksU0FBUyxDQUFDLENBQUM7UUFDdEUsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDOzs4R0F6S1UsaUJBQWlCO2tHQUFqQixpQkFBaUIscVpDMUI5Qiw4dUZBd0VROzJGRDlDSyxpQkFBaUI7a0JBUDdCLFNBQVM7K0JBQ0UsbUJBQW1COzJJQVVwQixjQUFjO3NCQUF0QixLQUFLO2dCQUNHLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxJQUFJO3NCQUFaLEtBQUs7Z0JBQ0ksT0FBTztzQkFBaEIsTUFBTTtnQkFDRSxJQUFJO3NCQUFaLEtBQUs7Z0JBQ0csVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0ksbUJBQW1CO3NCQUE1QixNQUFNO2dCQUNHLGNBQWM7c0JBQXZCLE1BQU07Z0JBQ0UsUUFBUTtzQkFBaEIsS0FBSztnQkFVRyxXQUFXO3NCQUFuQixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRG9DaGVjayxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZXNcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQge1xuICBUSU1FVEFCTEVfQ0hBTkdFX0RJUkVDVElPTlMsXG4gIHdlZWtEYXlMYWJlbHMsXG59IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IENhbGVuZGFyVHlwZSB9IGZyb20gJy4vdHlwaW5ncyc7XG5pbXBvcnQgeyBUYWRhTmd4Q2FsZW5kYXJIZWxwZXIgfSBmcm9tICcuL2NhbGVuZGFyLmhlbHBlcic7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RhZGEtbmd4LWNhbGVuZGFyJyxcbiAgdGVtcGxhdGVVcmw6IGBjYWxlbmRhci5jb21wb25lbnQuaHRtbGAsXG4gIHN0eWxlVXJsczogW1xuICAgICdjYWxlbmRhci5jb21wb25lbnQuc2NzcydcbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBDYWxlbmRhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgRG9DaGVjayB7XG5cbiAgbGVzc2lvbk51bU9mRGF5ID0gWy4uLkFycmF5KDUpLmtleXMoKV07XG5cbiAgQElucHV0KCkgc3RhcnRSb3dUaXRsZXM6IHN0cmluZ1tdID0gdGhpcy5idWlsZFJvd1RpdGxlcygpO1xuICBASW5wdXQoKSBtb250aDogbnVtYmVyID0gdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuZ2V0Q3VycmVudE1vbnRoKCk7XG4gIEBJbnB1dCgpIHllYXI6IG51bWJlciA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmdldEFjdGl2ZVllYXIoKTtcbiAgQE91dHB1dCgpIHVwZGF0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBJbnB1dCgpIGRhdGE6IGFueSA9IG51bGw7XG4gIEBJbnB1dCgpIHRpbWVTaGlmdHM6IGFueVtdID0gW107XG4gIEBJbnB1dCgpIGxlc3Npb25Vbml0OiBhbnk7XG4gIEBJbnB1dCgpIHVzZXJUeXBlOiBhbnk7XG4gIEBPdXRwdXQoKSBvbkNoYW5nZU9uT2ZmU3dpdGNoID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBzY2hlZHVsZU9wZW5lZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBASW5wdXQoKSBpc0JPU2lkZTogYW55O1xuICBkYXluYW1lc09mV2VlayA9IFsuLi53ZWVrRGF5TGFiZWxzXTtcbiAgdGltZVRhYmxlRGF0YTogYW55ID0ge307XG4gIG9iamVjdEtleXMgPSBPYmplY3Qua2V5cztcbiAgd2Vla2RheXM6IGFueVtdID0gW107XG4gIHNjaGVkdWxlczogYW55ID0ge307XG4gIHRpbWVUYWJsZVVJRGF0YTogQ2FsZW5kYXJUeXBlID0ge307XG4gIGFjdGl2ZVdlZWs6IG51bWJlciA9IDA7XG4gIHRvdGFsV2Vla09mWWVhciA9IDA7XG4gIHN0YXJ0RGF5T2ZXZWVrOiBhbnkgPSBudWxsO1xuICBASW5wdXQoKSBhc3NpZ25tZW50czogYW55W10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHRhZGFOZ3hDYWxlbmRhckhlbHBlcjogVGFkYU5neENhbGVuZGFySGVscGVyLFxuICAgIHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlXG4gICkge1xuICAgIHRoaXMudHJhbnNsYXRlLnNldERlZmF1bHRMYW5nKCd2bicpO1xuICAgIHRoaXMuYnVpbGRSb3dUaXRsZXMoKTtcbiAgfVxuXG4gIG5nRG9DaGVjaygpOiB2b2lkIHsgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcblxuICAgIGlmIChjaGFuZ2VzWydkYXRhJ10/LmN1cnJlbnRWYWx1ZSAmJiBjaGFuZ2VzWydkYXRhJ10/LmN1cnJlbnRWYWx1ZS5sZW5ndGgpIHtcbiAgICAgIHRoaXMub25DaGFuZ2VTY2hlZHVsZXMoKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICBjaGFuZ2VzWydtb250aCddPy5maXJzdENoYW5nZSAmJlxuICAgICAgY2hhbmdlc1snbW9udGgnXS5jdXJyZW50VmFsdWUgJiZcbiAgICAgIGNoYW5nZXNbJ3llYXInXT8uZmlyc3RDaGFuZ2UgJiZcbiAgICAgIGNoYW5nZXNbJ3llYXInXS5jdXJyZW50VmFsdWVcbiAgICApIHtcbiAgICAgIHRoaXMuYWN0aXZlV2VlayA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmN1cnJlbnRXZWVrTnVtYmVyKCk7XG4gICAgICB0aGlzLnRvdGFsV2Vla09mWWVhciA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmlzb1dlZWtzSW5ZZWFyKHRoaXMueWVhcik7XG4gICAgICB0aGlzLm9uQ2hhbmdlRGlyZWN0aW9uKFRJTUVUQUJMRV9DSEFOR0VfRElSRUNUSU9OUy5NT1ZFX1RPREFZKTtcbiAgICB9IGVsc2UgaWYgKGNoYW5nZXNbJ21vbnRoJ10/LmN1cnJlbnRWYWx1ZSB8fCBjaGFuZ2VzWyd5ZWFyJ10/LmN1cnJlbnRWYWx1ZSkge1xuICAgICAgdGhpcy5jaGFuZ2VNb250aFllYXIoKTtcbiAgICB9XG5cbiAgfVxuXG4gIGJ1aWxkUm93VGl0bGVzKCkge1xuICAgIHJldHVybiB0aGlzLmxlc3Npb25OdW1PZkRheS5tYXAoXG4gICAgICAoXywgaW5kZXg6IG51bWJlcikgPT4gYFRp4bq/dCAke2luZGV4ICsgMX1gXG4gICAgKTtcbiAgfVxuXG4gIG9uQ2hhbmdlRGlyZWN0aW9uKGFjdGlvbjogc3RyaW5nKSB7XG4gICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgIGNhc2UgVElNRVRBQkxFX0NIQU5HRV9ESVJFQ1RJT05TLk1PVkVfUFJFVjpcbiAgICAgICAgdGhpcy5nb1ByZXZpb3VzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBUSU1FVEFCTEVfQ0hBTkdFX0RJUkVDVElPTlMuTU9WRV9ORVhUOlxuICAgICAgICB0aGlzLmdvTmV4dCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVElNRVRBQkxFX0NIQU5HRV9ESVJFQ1RJT05TLk1PVkVfVE9EQVk6XG4gICAgICAgIHRoaXMudG9kYXkoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5oYW5kbGVEYXRldGltZSh0aGlzLnN0YXJ0RGF5T2ZXZWVrKTtcbiAgfVxuXG4gIGNhbkdvUHJldmlvdXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZlV2VlayA8IHRoaXMudG90YWxXZWVrT2ZZZWFyO1xuICB9XG5cbiAgY2FuR29OZXh0KCkge1xuICAgIHJldHVybiB0aGlzLmFjdGl2ZVdlZWsgPCB0aGlzLnRvdGFsV2Vla09mWWVhcjtcbiAgfVxuXG4gIGdvUHJldmlvdXMoKSB7XG4gICAgdGhpcy5zdGFydERheU9mV2VlayA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLnN1YnRyYWN0KFxuICAgICAgdGhpcy5zdGFydERheU9mV2Vla1xuICAgICk7XG4gIH1cblxuICBnb05leHQoKSB7XG4gICAgdGhpcy5zdGFydERheU9mV2VlayA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmFkZCh0aGlzLnN0YXJ0RGF5T2ZXZWVrKTtcbiAgfVxuXG4gIHRvZGF5KCkge1xuICAgIGNvbnN0IGN1cnJlbnRXZWVrID0gdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuY3VycmVudFdlZWtOdW1iZXIoKTtcbiAgICB0aGlzLnN0YXJ0RGF5T2ZXZWVrID0gdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuZGF5U3RhcnRPZldlZWsoXG4gICAgICBjdXJyZW50V2VlayxcbiAgICAgIHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmdldEN1cnJlbnRZZWFyKClcbiAgICApO1xuICB9XG5cbiAgaGFuZGxlRGF0ZXRpbWUoZnJvbURhdGU6IHN0cmluZykge1xuICAgIHRoaXMud2Vla2RheXMgPSB0aGlzLnRhZGFOZ3hDYWxlbmRhckhlbHBlci5nZXRXZWVrRGF5c0J5RGF5KGZyb21EYXRlKTtcbiAgICB0aGlzLmFjdGl2ZVdlZWsgPSB0aGlzLnRhZGFOZ3hDYWxlbmRhckhlbHBlci5nZXRXZWVrTnVtYmVyQnlEYXRlKFxuICAgICAgdGhpcy53ZWVrZGF5c1swXVxuICAgICk7XG4gICAgY29uc3QgW3llYXIsIG1vbnRoXSA9IGZyb21EYXRlLnNwbGl0KCctJyk7XG5cbiAgICB0aGlzLm1vbnRoID0gK21vbnRoO1xuICAgIHRoaXMueWVhciA9ICt5ZWFyO1xuXG4gICAgdGhpcy5zdGFydERheU9mV2VlayA9IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmRheVN0YXJ0T2ZXZWVrKFxuICAgICAgdGhpcy5hY3RpdmVXZWVrLFxuICAgICAgdGhpcy55ZWFyXG4gICAgKTtcbiAgICB0aGlzLnRpbWVUYWJsZVVJRGF0YSA9IHtcbiAgICAgIHN0YXJ0RGF0ZTogdGhpcy50YWRhTmd4Q2FsZW5kYXJIZWxwZXIuZ2V0VGltZVJhbmdlKHRoaXMud2Vla2RheXNbMF0pXG4gICAgICAgIC50aW1lU3RhbXBVdGMuc3RhcnRPZkRheSxcbiAgICAgIGVuZERhdGU6IHRoaXMudGFkYU5neENhbGVuZGFySGVscGVyLmdldFRpbWVSYW5nZShcbiAgICAgICAgdGhpcy53ZWVrZGF5c1t0aGlzLndlZWtkYXlzLmxlbmd0aCAtIDFdXG4gICAgICApLnRpbWVTdGFtcFV0Yy5lbmRPZkRheSxcbiAgICAgIHdlZWtOdW1iZXI6IHRoaXMuYWN0aXZlV2VlayxcbiAgICB9O1xuXG4gICAgdGhpcy51cGRhdGVkLmVtaXQodGhpcy50aW1lVGFibGVVSURhdGEpO1xuICAgIHRoaXMucmVuZGVyRGF5T2ZXZWVrKCk7XG4gIH1cblxuICBjaGFuZ2VNb250aFllYXIoKSB7XG4gICAgY29uc3QgbmV3RGF0ZSA9IGAke3RoaXMueWVhcn0tJHt0aGlzLm1vbnRofS0wMWA7XG4gICAgdGhpcy5oYW5kbGVEYXRldGltZShuZXdEYXRlKTtcbiAgfVxuXG4gIGdlbmVyYXRlQmFzaWNEYXRlKCkge1xuICAgIHRoaXMuZGF5bmFtZXNPZldlZWsuZm9yRWFjaCgoZGF5OiBzdHJpbmcpID0+IHtcbiAgICAgIHRoaXMudGltZVRhYmxlRGF0YVtkYXldID0ge1xuICAgICAgICBpdGVtczogW10sXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgcmVuZGVyRGF5T2ZXZWVrKCkge1xuICAgIHRoaXMuc2NoZWR1bGVzID0gdGhpcy53ZWVrZGF5cy5yZWR1Y2UoXG4gICAgICAocHJldjogYW55LCBjdXJyZW50OiBhbnkpID0+ICh7IC4uLnByZXYsIFtjdXJyZW50XTogY3VycmVudCB9KSxcbiAgICAgIHt9XG4gICAgKTtcbiAgfVxuXG4gIG9uQ2hhbmdlU2NoZWR1bGVzKCkge1xuICAgIHRoaXMud2Vla2RheXMuZm9yRWFjaCgoZGF5KSA9PiB7XG4gICAgICBjb25zdCBzbG90c09mRGF5ID0gdGhpcy5kYXRhLmZpbHRlcigoc2xvdDogYW55KSA9PlxuICAgICAgICB0aGlzLnRhZGFOZ3hDYWxlbmRhckhlbHBlci5pbkRheShzbG90LnN0YXJ0VGltZSwgZGF5KVxuICAgICAgKTtcbiAgICAgIHRoaXMudGltZVRhYmxlRGF0YVtkYXldID0ge1xuICAgICAgICBpdGVtczogXy5vcmRlckJ5KHNsb3RzT2ZEYXksIFsnb3JkZXInXSksXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0TGVzc29uQnlPcmRlcihkYXk6IHN0cmluZywgaW5kZXg6IG51bWJlciwgdGltZVNoaWZ0OiBzdHJpbmcpIHtcbiAgICBjb25zdCBmb3VuZCA9IHRoaXMudGltZVRhYmxlRGF0YVtkYXldPy5pdGVtcy5maW5kKFxuICAgICAgKGl0ZW06IGFueSkgPT4gaXRlbS5vcmRlciA9PT0gaW5kZXggJiYgaXRlbS50aW1lU2hpZnQgPT0gdGltZVNoaWZ0KTtcbiAgICByZXR1cm4gZm91bmQ7XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJoZWFkZXItdGltZXRhYmxlLXdvcmtpbmdcIj5cbiAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1iZXR3ZWVuXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0aW1ldGFibGV1aS1hY3RpdmUtd2Vla251bVwiPlxuICAgICAgICAgIFR14bqnbiB7eyB0aW1lVGFibGVVSURhdGE/LndlZWtOdW1iZXIgfX0gdGjDoW5nIHt7bW9udGh9fSBuxINtIHt7IHN0YXJ0RGF5T2ZXZWVrIHwgZGF0ZTogJ3l5eXknIH19XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDx0YWRhLW5neC1jYWxlbmRhci1uYXZpZ2F0aW9uXG4gICAgICAgICAgICAobmF2aUNoYW5nZSk9XCJvbkNoYW5nZURpcmVjdGlvbigkZXZlbnQpXCJcbiAgICAgICAgICA+PC90YWRhLW5neC1jYWxlbmRhci1uYXZpZ2F0aW9uPlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIFxuICA8ZGl2ICpuZ0Zvcj1cImxldCB0aW1lU2hpZnQgb2YgdGltZVNoaWZ0czsgaW5kZXggYXMgdGltZVNoaWZ0SW5kZXhcIj5cblxuICA8aDQgY2xhc3M9XCJ0aW1lc2hpZnRfdGl0bGVcIj57eyB0aW1lU2hpZnQgfCB0cmFuc2xhdGUgfX08L2g0PlxuICBcbiAgPGRpdiBjbGFzcz1cInRhZGEtbmd4LWNhbGVuZGFyIG1iLTNcIj5cbiAgICA8ZGl2IGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItd3JhcC1zY3JvbGxcIj5cbiAgICAgIDxkaXYgaWQ9XCJ0YWRhLW5neC1jYWxlbmRhci1jYWxlbmRhclwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItcHJlZml4LWNvbHVtbiB0YWRhLW5neC1jYWxlbmRhci1kYXktY29sdW1uXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInRhZGEtbmd4LWNhbGVuZGFyLWRheS1jb2x1bW4tbGVzc2lvblwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRhZGEtbmd4LWNhbGVuZGFyLWRheS1uYW1lXCIgKm5nSWY9XCJ0aW1lU2hpZnRJbmRleCA9PSAwXCI+XG4gICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgPHNwYW4+PC9zcGFuPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICBjbGFzcz1cInRhZGEtbmd4LWNhbGVuZGFyLWRheS1sZXNzaW9uLWl0ZW0gcHJlLWxhYmVsLWNvbHVtbi12YWx1ZVwiXG4gICAgICAgICAgICAgICpuZ0Zvcj1cImxldCB0aXRsZSBvZiBzdGFydFJvd1RpdGxlc1wiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgPHNwYW4+e3sgdGl0bGUgfX08L3NwYW4+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgKm5nRm9yPVwibGV0IGRheSBvZiBvYmplY3RLZXlzKHNjaGVkdWxlcyk7IGluZGV4IGFzIGlcIlxuICAgICAgICAgIGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItZGF5LWNvbHVtblwiXG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItZGF5LWNvbHVtbi1sZXNzaW9uXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItZGF5LW5hbWVcIiAqbmdJZj1cInRpbWVTaGlmdEluZGV4ID09IDBcIj5cbiAgICAgICAgICAgICAgPHA+e3sgZGF5bmFtZXNPZldlZWtbaV0gfCB0cmFuc2xhdGUgfX08L3A+XG4gICAgICAgICAgICAgIDxoND57eyBkYXkgfCBkYXRlOiAnZCcgfX08L2g0PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIGNsYXNzPVwidGFkYS1uZ3gtY2FsZW5kYXItZGF5LWxlc3Npb24taXRlbVwiXG4gICAgICAgICAgICAgICpuZ0Zvcj1cImxldCBsZXNzb25OdW0gb2YgbGVzc2lvbk51bU9mRGF5XCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRpbWV0YWJsZS1jZWxsLWJsb2NrXCI+XG4gICAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICAgKm5nSWY9XCJnZXRMZXNzb25CeU9yZGVyKGRheSwgbGVzc29uTnVtKzEsIHRpbWVTaGlmdCkgYXMgbGVzc2lvblwiXG4gICAgICAgICAgICAgICAgICBjbGFzcz1cInRhZGEtbmd4LWNhbGVuZGFyLWRheS1zY2hlZHVsZS1pdGVtX19pdGVtXCJcbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICA8dGltZXRhYmxlLWNlbGxcbiAgICAgICAgICAgICAgICAgIFt1c2VyVHlwZV09XCJ1c2VyVHlwZVwiXG4gICAgICAgICAgICAgICAgICBbaXNCT1NpZGVdPVwiaXNCT1NpZGVcIlxuICAgICAgICAgICAgICAgICAgW2xlc3Npb25Vbml0XT1cImxlc3Npb25Vbml0XCJcbiAgICAgICAgICAgICAgICAgIFthc3NpZ25tZW50c109XCJhc3NpZ25tZW50c1wiXG4gICAgICAgICAgICAgICAgICAoc2NoZWR1bGVPcGVuZWQpPVwic2NoZWR1bGVPcGVuZWQuZW1pdCgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICAgIChvbkNoYW5nZU9uT2ZmU3dpdGNoKT1cIm9uQ2hhbmdlT25PZmZTd2l0Y2guZW1pdCgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICAgIFtzY2hlZHVsZV09XCJsZXNzaW9uXCI+PC90aW1ldGFibGUtY2VsbD5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIFxuICA8L2Rpdj4iXX0=